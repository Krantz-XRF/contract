<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Documentation.SBV.Examples.WeakestPreconditions.Sum</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">sbv-8.6: SMT Based Verification: Symbolic Haskell theorem prover using SMT solving.</span><ul class="links" id="page-menu"><li><a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) Levent Erkok</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>erkokl@gmail.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Documentation.SBV.Examples.WeakestPreconditions.Sum</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Program state</a></li><li><a href="#g:2">The algorithm</a></li><li><a href="#g:3">Correctness</a></li><li><a href="#g:4">Example proof attempts</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Proof of correctness of an imperative summation algorithm, using weakest
 preconditions. We investigate a few different invariants and see how
 different versions lead to proofs and failures.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:SumS">SumS</a> a = <a href="#v:SumS">SumS</a> {<ul class="subs"><li><a href="#v:n">n</a> :: a</li><li><a href="#v:i">i</a> :: a</li><li><a href="#v:s">s</a> :: a</li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:S">S</a> = <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> <a href="Data-SBV-Internals.html#t:SInteger" title="Data.SBV.Internals">SInteger</a></li><li class="src short"><a href="#v:algorithm">algorithm</a> :: <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Invariant" title="Data.SBV.Tools.WeakestPreconditions">Invariant</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="../base-4.13.0.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Data-SBV-Tools-WeakestPreconditions.html#t:Measure" title="Data.SBV.Tools.WeakestPreconditions">Measure</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a>) -&gt; <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Stmt" title="Data.SBV.Tools.WeakestPreconditions">Stmt</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a></li><li class="src short"><a href="#v:pre">pre</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="Data-SBV-Internals.html#t:SBool" title="Data.SBV.Internals">SBool</a></li><li class="src short"><a href="#v:post">post</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="Data-SBV-Internals.html#t:SBool" title="Data.SBV.Internals">SBool</a></li><li class="src short"><a href="#v:noChange">noChange</a> :: <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Stable" title="Data.SBV.Tools.WeakestPreconditions">Stable</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a></li><li class="src short"><a href="#v:imperativeSum">imperativeSum</a> :: <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Invariant" title="Data.SBV.Tools.WeakestPreconditions">Invariant</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="../base-4.13.0.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Data-SBV-Tools-WeakestPreconditions.html#t:Measure" title="Data.SBV.Tools.WeakestPreconditions">Measure</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a>) -&gt; <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Program" title="Data.SBV.Tools.WeakestPreconditions">Program</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a></li><li class="src short"><a href="#v:correctness">correctness</a> :: <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Invariant" title="Data.SBV.Tools.WeakestPreconditions">Invariant</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="../base-4.13.0.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Data-SBV-Tools-WeakestPreconditions.html#t:Measure" title="Data.SBV.Tools.WeakestPreconditions">Measure</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a>) -&gt; <a href="../base-4.13.0.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-SBV-Tools-WeakestPreconditions.html#t:ProofResult" title="Data.SBV.Tools.WeakestPreconditions">ProofResult</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> <a href="../base-4.13.0.0/Prelude.html#t:Integer" title="Prelude">Integer</a>))</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Program state</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SumS" class="def">SumS</a> a <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#SumS" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></p><div class="doc"><p>The state for the sum program, parameterized over a base type <code>a</code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SumS" class="def">SumS</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:n" class="def">n</a> :: a</dfn><div class="doc"><p>The input value</p></div></li><li><dfn class="src"><a id="v:i" class="def">i</a> :: a</dfn><div class="doc"><p>Loop counter</p></div></li><li><dfn class="src"><a id="v:s" class="def">s</a> :: a</dfn><div class="doc"><p>Running sum</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:SumS">Instances</h4><details id="i:SumS" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SumS:Functor:1"></span> <a href="../base-4.13.0.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a></span> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#line-40" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SumS:Functor:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html">Documentation.SBV.Examples.WeakestPreconditions.Sum</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fmap">fmap</a> :: (a -&gt; b) -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> b <a href="#v:fmap" class="selflink">#</a></p><p class="src"><a href="#v:-60--36-">(&lt;$)</a> :: a -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> b -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a <a href="#v:-60--36-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SumS:Foldable:2"></span> <a href="../base-4.13.0.0/Data-Foldable.html#t:Foldable" title="Data.Foldable">Foldable</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a></span> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#line-40" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SumS:Foldable:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html">Documentation.SBV.Examples.WeakestPreconditions.Sum</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fold">fold</a> :: <a href="../base-4.13.0.0/Data-Monoid.html#t:Monoid" title="Data.Monoid">Monoid</a> m =&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> m -&gt; m <a href="#v:fold" class="selflink">#</a></p><p class="src"><a href="#v:foldMap">foldMap</a> :: <a href="../base-4.13.0.0/Data-Monoid.html#t:Monoid" title="Data.Monoid">Monoid</a> m =&gt; (a -&gt; m) -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; m <a href="#v:foldMap" class="selflink">#</a></p><p class="src"><a href="#v:foldMap-39-">foldMap'</a> :: <a href="../base-4.13.0.0/Data-Monoid.html#t:Monoid" title="Data.Monoid">Monoid</a> m =&gt; (a -&gt; m) -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; m <a href="#v:foldMap-39-" class="selflink">#</a></p><p class="src"><a href="#v:foldr">foldr</a> :: (a -&gt; b -&gt; b) -&gt; b -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; b <a href="#v:foldr" class="selflink">#</a></p><p class="src"><a href="#v:foldr-39-">foldr'</a> :: (a -&gt; b -&gt; b) -&gt; b -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; b <a href="#v:foldr-39-" class="selflink">#</a></p><p class="src"><a href="#v:foldl">foldl</a> :: (b -&gt; a -&gt; b) -&gt; b -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; b <a href="#v:foldl" class="selflink">#</a></p><p class="src"><a href="#v:foldl-39-">foldl'</a> :: (b -&gt; a -&gt; b) -&gt; b -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; b <a href="#v:foldl-39-" class="selflink">#</a></p><p class="src"><a href="#v:foldr1">foldr1</a> :: (a -&gt; a -&gt; a) -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; a <a href="#v:foldr1" class="selflink">#</a></p><p class="src"><a href="#v:foldl1">foldl1</a> :: (a -&gt; a -&gt; a) -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; a <a href="#v:foldl1" class="selflink">#</a></p><p class="src"><a href="#v:toList">toList</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; [a] <a href="#v:toList" class="selflink">#</a></p><p class="src"><a href="#v:null">null</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="../base-4.13.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:null" class="selflink">#</a></p><p class="src"><a href="#v:length">length</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="../base-4.13.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="#v:length" class="selflink">#</a></p><p class="src"><a href="#v:elem">elem</a> :: <a href="../base-4.13.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> a =&gt; a -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="../base-4.13.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:elem" class="selflink">#</a></p><p class="src"><a href="#v:maximum">maximum</a> :: <a href="../base-4.13.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> a =&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; a <a href="#v:maximum" class="selflink">#</a></p><p class="src"><a href="#v:minimum">minimum</a> :: <a href="../base-4.13.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> a =&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; a <a href="#v:minimum" class="selflink">#</a></p><p class="src"><a href="#v:sum">sum</a> :: <a href="../base-4.13.0.0/Prelude.html#t:Num" title="Prelude">Num</a> a =&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; a <a href="#v:sum" class="selflink">#</a></p><p class="src"><a href="#v:product">product</a> :: <a href="../base-4.13.0.0/Prelude.html#t:Num" title="Prelude">Num</a> a =&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; a <a href="#v:product" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SumS:Traversable:3"></span> <a href="../base-4.13.0.0/Data-Traversable.html#t:Traversable" title="Data.Traversable">Traversable</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a></span> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#line-40" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SumS:Traversable:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html">Documentation.SBV.Examples.WeakestPreconditions.Sum</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:traverse">traverse</a> :: <a href="../base-4.13.0.0/Control-Applicative.html#t:Applicative" title="Control.Applicative">Applicative</a> f =&gt; (a -&gt; f b) -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; f (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> b) <a href="#v:traverse" class="selflink">#</a></p><p class="src"><a href="#v:sequenceA">sequenceA</a> :: <a href="../base-4.13.0.0/Control-Applicative.html#t:Applicative" title="Control.Applicative">Applicative</a> f =&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> (f a) -&gt; f (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a) <a href="#v:sequenceA" class="selflink">#</a></p><p class="src"><a href="#v:mapM">mapM</a> :: <a href="../base-4.13.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m =&gt; (a -&gt; m b) -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; m (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> b) <a href="#v:mapM" class="selflink">#</a></p><p class="src"><a href="#v:sequence">sequence</a> :: <a href="../base-4.13.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m =&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> (m a) -&gt; m (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a) <a href="#v:sequence" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SumS:Fresh:4"></span> (<a href="Data-SBV-Internals.html#t:SymVal" title="Data.SBV.Internals">SymVal</a> a, <a href="Data-SBV-Trans-Control.html#t:SMTValue" title="Data.SBV.Trans.Control">SMTValue</a> a) =&gt; <a href="Data-SBV-Control.html#t:Fresh" title="Data.SBV.Control">Fresh</a> <a href="../base-4.13.0.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> (<a href="Data-SBV-Internals.html#t:SBV" title="Data.SBV.Internals">SBV</a> a))</span> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#line-51" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></td><td class="doc"><p><code><a href="Data-SBV-Control.html#t:Fresh" title="Data.SBV.Control">Fresh</a></code> instance for the program state</p></td></tr><tr><td colspan="2"><details id="i:id:SumS:Fresh:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html">Documentation.SBV.Examples.WeakestPreconditions.Sum</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fresh">fresh</a> :: <a href="Data-SBV-Trans-Control.html#t:QueryT" title="Data.SBV.Trans.Control">QueryT</a> <a href="../base-4.13.0.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> (<a href="Data-SBV-Internals.html#t:SBV" title="Data.SBV.Internals">SBV</a> a)) <a href="src/Data.SBV.Core.Symbolic.html#fresh" class="link">Source</a> <a href="#v:fresh" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SumS:Show:5"></span> <a href="../base-4.13.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a =&gt; <a href="../base-4.13.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a)</span> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#line-40" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SumS:Show:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html">Documentation.SBV.Examples.WeakestPreconditions.Sum</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.13.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="../base-4.13.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a] -&gt; <a href="../base-4.13.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SumS:Show:6"></span> (<a href="Data-SBV-Internals.html#t:SymVal" title="Data.SBV.Internals">SymVal</a> a, <a href="../base-4.13.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a) =&gt; <a href="../base-4.13.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> (<a href="Data-SBV-Internals.html#t:SBV" title="Data.SBV.Internals">SBV</a> a))</span> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#line-44" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></td><td class="doc"><p>Show instance for <code><a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a></code>. The above deriving clause would work just as well,
 but we want it to be a little prettier here, and hence the <code>OVERLAPS</code> directive.</p></td></tr><tr><td colspan="2"><details id="i:id:SumS:Show:6"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html">Documentation.SBV.Examples.WeakestPreconditions.Sum</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.13.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> (<a href="Data-SBV-Internals.html#t:SBV" title="Data.SBV.Internals">SBV</a> a) -&gt; <a href="../base-4.13.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> (<a href="Data-SBV-Internals.html#t:SBV" title="Data.SBV.Internals">SBV</a> a) -&gt; <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> (<a href="Data-SBV-Internals.html#t:SBV" title="Data.SBV.Internals">SBV</a> a)] -&gt; <a href="../base-4.13.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SumS:Generic:7"></span> <a href="../base-4.13.0.0/GHC-Generics.html#t:Generic" title="GHC.Generics">Generic</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a)</span> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#line-40" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SumS:Generic:7"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html">Documentation.SBV.Examples.WeakestPreconditions.Sum</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../base-4.13.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a) :: <a href="../base-4.13.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="../base-4.13.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="../base-4.13.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a) x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> :: <a href="../base-4.13.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a) x -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SumS:Mergeable:8"></span> <a href="Data-SBV-Trans.html#t:Mergeable" title="Data.SBV.Trans">Mergeable</a> a =&gt; <a href="Data-SBV-Trans.html#t:Mergeable" title="Data.SBV.Trans">Mergeable</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a)</span> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#line-40" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SumS:Mergeable:8"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html">Documentation.SBV.Examples.WeakestPreconditions.Sum</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:symbolicMerge">symbolicMerge</a> :: <a href="../base-4.13.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> -&gt; <a href="Data-SBV-Internals.html#t:SBool" title="Data.SBV.Internals">SBool</a> -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a <a href="src/Data.SBV.Core.Model.html#symbolicMerge" class="link">Source</a> <a href="#v:symbolicMerge" class="selflink">#</a></p><p class="src"><a href="#v:select">select</a> :: (<a href="../base-4.13.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> b, <a href="Data-SBV-Internals.html#t:SymVal" title="Data.SBV.Internals">SymVal</a> b, <a href="../base-4.13.0.0/Prelude.html#t:Num" title="Prelude">Num</a> b) =&gt; [<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a] -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a -&gt; <a href="Data-SBV-Internals.html#t:SBV" title="Data.SBV.Internals">SBV</a> b -&gt; <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a <a href="src/Data.SBV.Core.Model.html#select" class="link">Source</a> <a href="#v:select" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SumS:Rep:9"></span> <span class="keyword">type</span> <a href="../base-4.13.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a)</span> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#line-40" class="link">Source</a> <a href="#t:SumS" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SumS:Rep:9"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html">Documentation.SBV.Examples.WeakestPreconditions.Sum</a></p> <div class="src"><span class="keyword">type</span> <a href="../base-4.13.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> a) = <a href="../base-4.13.0.0/GHC-Generics.html#t:D1" title="GHC.Generics">D1</a> ('<a href="../base-4.13.0.0/GHC-Generics.html#v:MetaData" title="GHC.Generics">MetaData</a> &quot;SumS&quot; &quot;Documentation.SBV.Examples.WeakestPreconditions.Sum&quot; &quot;sbv-8.6-4S9z5R1TCJr59anjkda4w3&quot; '<a href="../base-4.13.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a>) (<a href="../base-4.13.0.0/GHC-Generics.html#t:C1" title="GHC.Generics">C1</a> ('<a href="../base-4.13.0.0/GHC-Generics.html#v:MetaCons" title="GHC.Generics">MetaCons</a> &quot;SumS&quot; '<a href="../base-4.13.0.0/GHC-Generics.html#v:PrefixI" title="GHC.Generics">PrefixI</a> '<a href="../base-4.13.0.0/Data-Bool.html#v:True" title="Data.Bool">True</a>) (<a href="../base-4.13.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> ('<a href="../base-4.13.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> ('<a href="../base-4.13.0.0/Data-Maybe.html#v:Just" title="Data.Maybe">Just</a> &quot;n&quot;) '<a href="../base-4.13.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> '<a href="../base-4.13.0.0/GHC-Generics.html#v:NoSourceStrictness" title="GHC.Generics">NoSourceStrictness</a> '<a href="../base-4.13.0.0/GHC-Generics.html#v:DecidedLazy" title="GHC.Generics">DecidedLazy</a>) (<a href="../base-4.13.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> a) <a href="../base-4.13.0.0/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> (<a href="../base-4.13.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> ('<a href="../base-4.13.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> ('<a href="../base-4.13.0.0/Data-Maybe.html#v:Just" title="Data.Maybe">Just</a> &quot;i&quot;) '<a href="../base-4.13.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> '<a href="../base-4.13.0.0/GHC-Generics.html#v:NoSourceStrictness" title="GHC.Generics">NoSourceStrictness</a> '<a href="../base-4.13.0.0/GHC-Generics.html#v:DecidedLazy" title="GHC.Generics">DecidedLazy</a>) (<a href="../base-4.13.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> a) <a href="../base-4.13.0.0/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> <a href="../base-4.13.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> ('<a href="../base-4.13.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> ('<a href="../base-4.13.0.0/Data-Maybe.html#v:Just" title="Data.Maybe">Just</a> &quot;s&quot;) '<a href="../base-4.13.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> '<a href="../base-4.13.0.0/GHC-Generics.html#v:NoSourceStrictness" title="GHC.Generics">NoSourceStrictness</a> '<a href="../base-4.13.0.0/GHC-Generics.html#v:DecidedLazy" title="GHC.Generics">DecidedLazy</a>) (<a href="../base-4.13.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> a))))</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:S" class="def">S</a> = <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> <a href="Data-SBV-Internals.html#t:SInteger" title="Data.SBV.Internals">SInteger</a> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#S" class="link">Source</a> <a href="#t:S" class="selflink">#</a></p><div class="doc"><p>Helper type synonym</p></div></div><a href="#g:2" id="g:2"><h1>The algorithm</h1></a><div class="top"><p class="src"><a id="v:algorithm" class="def">algorithm</a> :: <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Invariant" title="Data.SBV.Tools.WeakestPreconditions">Invariant</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="../base-4.13.0.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Data-SBV-Tools-WeakestPreconditions.html#t:Measure" title="Data.SBV.Tools.WeakestPreconditions">Measure</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a>) -&gt; <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Stmt" title="Data.SBV.Tools.WeakestPreconditions">Stmt</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#algorithm" class="link">Source</a> <a href="#v:algorithm" class="selflink">#</a></p><div class="doc"><p>The imperative summation algorithm:</p><pre>   i = 0
   s = 0
   while i &lt; n
     i = i+1
     s = s+i
</pre><p>Note that we need to explicitly annotate each loop with its invariant and the termination
 measure. For convenience, we take those two as parameters, so we can experiment later.</p></div></div><div class="top"><p class="src"><a id="v:pre" class="def">pre</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="Data-SBV-Internals.html#t:SBool" title="Data.SBV.Internals">SBool</a> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#pre" class="link">Source</a> <a href="#v:pre" class="selflink">#</a></p><div class="doc"><p>Precondition for our program: <code>n</code> must be non-negative. Note that there is
 an explicit call to <code><a href="Data-SBV-Tools-WeakestPreconditions.html#v:abort" title="Data.SBV.Tools.WeakestPreconditions">abort</a></code> in our program to protect against this case, so
 if we do not have this precondition, all programs will fail.</p></div></div><div class="top"><p class="src"><a id="v:post" class="def">post</a> :: <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="Data-SBV-Internals.html#t:SBool" title="Data.SBV.Internals">SBool</a> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#post" class="link">Source</a> <a href="#v:post" class="selflink">#</a></p><div class="doc"><p>Postcondition for our program: <code>s</code> must be the sum of all numbers up to
 and including <code>n</code>.</p></div></div><div class="top"><p class="src"><a id="v:noChange" class="def">noChange</a> :: <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Stable" title="Data.SBV.Tools.WeakestPreconditions">Stable</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#noChange" class="link">Source</a> <a href="#v:noChange" class="selflink">#</a></p><div class="doc"><p>Stability condition: Program must leave <code>n</code> unchanged.</p></div></div><div class="top"><p class="src"><a id="v:imperativeSum" class="def">imperativeSum</a> :: <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Invariant" title="Data.SBV.Tools.WeakestPreconditions">Invariant</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="../base-4.13.0.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Data-SBV-Tools-WeakestPreconditions.html#t:Measure" title="Data.SBV.Tools.WeakestPreconditions">Measure</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a>) -&gt; <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Program" title="Data.SBV.Tools.WeakestPreconditions">Program</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#imperativeSum" class="link">Source</a> <a href="#v:imperativeSum" class="selflink">#</a></p><div class="doc"><p>A program is the algorithm, together with its pre- and post-conditions.</p></div></div><a href="#g:3" id="g:3"><h1>Correctness</h1></a><div class="top"><p class="src"><a id="v:correctness" class="def">correctness</a> :: <a href="Data-SBV-Tools-WeakestPreconditions.html#t:Invariant" title="Data.SBV.Tools.WeakestPreconditions">Invariant</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a> -&gt; <a href="../base-4.13.0.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="Data-SBV-Tools-WeakestPreconditions.html#t:Measure" title="Data.SBV.Tools.WeakestPreconditions">Measure</a> <a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:S" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">S</a>) -&gt; <a href="../base-4.13.0.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-SBV-Tools-WeakestPreconditions.html#t:ProofResult" title="Data.SBV.Tools.WeakestPreconditions">ProofResult</a> (<a href="Documentation-SBV-Examples-WeakestPreconditions-Sum.html#t:SumS" title="Documentation.SBV.Examples.WeakestPreconditions.Sum">SumS</a> <a href="../base-4.13.0.0/Prelude.html#t:Integer" title="Prelude">Integer</a>)) <a href="src/Documentation.SBV.Examples.WeakestPreconditions.Sum.html#correctness" class="link">Source</a> <a href="#v:correctness" class="selflink">#</a></p><div class="doc"><p>Check that the program terminates and <code>s</code> equals <code>n*(n+1)/2</code>
 upon termination, i.e., the sum of all numbers upto <code>n</code>. Note
 that this only holds if <code>n &gt;= 0</code> to start with, as guaranteed
 by the precondition of our program.</p><p>The correct termination measure is <code>n-i</code>: It goes down in each
 iteration provided we start with <code>n &gt;= 0</code> and it always remains
 non-negative while the loop is executing. Note that we do not
 need a lexicographic measure in this case, hence we simply return
 a list of one element.</p><p>The correct invariant is a conjunction of two facts. First, <code>s</code> is
 equivalent to the sum of numbers <code>0</code> upto <code>i</code>.  This clearly holds at
 the beginning when <code>i = s = 0</code>, and is maintained in each iteration
 of the body. Second, it always holds that <code>i &lt;= n</code> as long as the
 loop executes, both before and after each execution of the body.
 When the loop terminates, it holds that <code>i = n</code>. Since the invariant says
 <code>s</code> is the sum of all numbers up to but not including <code>i</code>, we
 conclude that <code>s</code> is the sum of all numbers up to and including <code>n</code>,
 as requested.</p><p>Note that coming up with this invariant is neither trivial, nor easy
 to automate by any means. What SBV provides is a way to check that
 your invariant and termination measures are correct, not
 a means of coming up with them in the first place.</p><p>We have:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XNamedFieldPuns
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let invariant SumS{n, i, s} = s .== (i*(i+1)) `sDiv` 2 .&amp;&amp; i .&lt;= n
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let measure   SumS{n, i}    = [n - i]
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>correctness invariant (Just measure)
</code></strong>Total correctness is established.
Q.E.D.
</pre></div></div><a href="#g:4" id="g:4"><h1>Example proof attempts</h1></a><div class="doc empty">&nbsp;</div><div class="doc"><p>It is instructive to look at several proof attempts to see what can go wrong and how
the weakest-precondition engine behaves.</p><h2>Always false invariant</h2><p>Let's see what happens if we have an always false invariant. Clearly, this will not
do the job, but it is instructive to see the output. For this exercise, we are only
interested in partial correctness (to see the impact of the invariant only), so we
will simply use <code><a href="../base-4.13.0.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> for the measures.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Control.Monad (void)
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let invariant _ = sFalse
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>void $ correctness invariant Nothing
</code></strong>Following proof obligation failed:
==================================
  Invariant for loop &quot;i &lt; n&quot; fails upon entry:
    SumS {n = 0, i = 0, s = 0}
</pre><p>When the invariant is constant false, it fails upon entry to the loop, and thus the
proof itself fails.</p><h2>Always true invariant</h2><p>The invariant must hold prior to entry to the loop, after the loop-body
executes, and must be strong enough to establish the postcondition. The easiest
thing to try would be the invariant that always returns true:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let invariant _ = sTrue
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>void $ correctness invariant Nothing
</code></strong>Following proof obligation failed:
==================================
  Postcondition fails:
    Start: SumS {n = 0, i = 0, s = 0}
    End  : SumS {n = 0, i = 0, s = 1}
</pre><p>In this case, we are told that the end state does not establish the
post-condition. Indeed when <code>n=0</code>, we would expect <code>s=0</code>, not <code>s=1</code>.</p><p>The natural question to ask is how did SBV come up with this unexpected
state at the end of the program run? If you think about the program execution, indeed this
state is unreachable: We know that <code>s</code> represents the sum of all numbers up to <code>i</code>,
so if <code>i=0</code>, we would expect <code>s</code> to be <code>0</code>. Our invariant is clearly an overapproximation
of the reachable space, and SBV is telling us that we need to constrain and outlaw
the state <code>{n = 0, i = 0, s = 1}</code>. Clearly, the invariant has to state something
about the relationship between <code>i</code> and <code>s</code>, which we are missing in this case.</p><h2>Failing to maintain the invariant</h2><p>What happens if we pose an invariant that the loop actually does not maintain? Here
is an example:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let invariant SumS{n, i, s} = s .&lt;= i .&amp;&amp; s .== (i*(i+1)) `sDiv` 2 .&amp;&amp; i .&lt;= n
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>void $ correctness invariant Nothing
</code></strong>Following proof obligation failed:
==================================
  Invariant for loop &quot;i &lt; n&quot; is not maintaned by the body:
    Before: SumS {n = 2, i = 1, s = 1}
    After : SumS {n = 2, i = 2, s = 3}
</pre><p>Here, we posed the extra incorrect invariant that <code>s &lt;= i</code> must be maintained, and SBV found us a reachable state that violates the invariant. The
show <em>before</em> state indeed satisfies <code>s &lt;= i</code>, but the <em>after</em> state does not. Note that the proof fails in this case not because the program
is incorrect, but the stipulated invariant is not valid.</p><h2>Having a bad measure, Part I</h2><p>The termination measure must always be non-negative:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let invariant SumS{n, i, s} = s .== (i*(i+1)) `sDiv` 2 .&amp;&amp; i .&lt;= n
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let measure   SumS{n, i}    = [- i]
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>void $ correctness invariant (Just measure)
</code></strong>Following proof obligation failed:
==================================
  Measure for loop &quot;i &lt; n&quot; is negative:
    State  : SumS {n = 2, i = 1, s = 1}
    Measure: -1
</pre><p>The failure is pretty obvious in this case: Measure produces a negative value.</p><h2>Having a bad measure, Part II</h2><p>The other way we can have a bad measure is if it fails to decrease through the loop body:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let invariant SumS{n, i, s} = s .== (i*(i+1)) `sDiv` 2 .&amp;&amp; i .&lt;= n
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let measure   SumS{n, i}    = [n + i]
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>void $ correctness invariant (Just measure)
</code></strong>Following proof obligation failed:
==================================
  Measure for loop &quot;i &lt; n&quot; does not decrease:
    Before : SumS {n = 1, i = 0, s = 0}
    Measure: 1
    After  : SumS {n = 1, i = 1, s = 1}
    Measure: 2
</pre><p>Clearly, as <code>i</code> increases, so does our bogus measure <code>n+i</code>.</p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>