<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Documentation.SBV.Examples.Strings.SQLInjection</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">sbv-8.6: SMT Based Verification: Symbolic Haskell theorem prover using SMT solving.</span><ul class="links" id="page-menu"><li><a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) Joel Burget</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>erkokl@gmail.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Documentation.SBV.Examples.Strings.SQLInjection</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Implement the symbolic evaluation of a language which operates on
 strings in a way similar to bash. It's possible to do different analyses,
 but this example finds program inputs which result in a query containing a
 SQL injection.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:SQLExpr">SQLExpr</a><ul class="subs"><li>= <a href="#v:Query">Query</a> <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a></li><li>| <a href="#v:Const">Const</a> <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a></li><li>| <a href="#v:Concat">Concat</a> <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a> <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a></li><li>| <a href="#v:ReadVar">ReadVar</a> <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:M">M</a> = <a href="../mtl-2.2.2/Control-Monad-State-Lazy.html#t:StateT" title="Control.Monad.State.Lazy">StateT</a> (<a href="Data-SBV-Internals.html#t:SFunArray" title="Data.SBV.Internals">SFunArray</a> <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a>) (<a href="../mtl-2.2.2/Control-Monad-Writer-Lazy.html#t:WriterT" title="Control.Monad.Writer.Lazy">WriterT</a> [<a href="Data-SBV-Internals.html#t:SString" title="Data.SBV.Internals">SString</a>] <a href="Data-SBV-Internals.html#t:Symbolic" title="Data.SBV.Internals">Symbolic</a>)</li><li class="src short"><a href="#v:eval">eval</a> :: <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a> -&gt; <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:M" title="Documentation.SBV.Examples.Strings.SQLInjection">M</a> <a href="Data-SBV-Internals.html#t:SString" title="Data.SBV.Internals">SString</a></li><li class="src short"><a href="#v:exampleProgram">exampleProgram</a> :: <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a></li><li class="src short"><a href="#v:nameRe">nameRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a></li><li class="src short"><a href="#v:strRe">strRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a></li><li class="src short"><a href="#v:selectRe">selectRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a></li><li class="src short"><a href="#v:dropRe">dropRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a></li><li class="src short"><a href="#v:statementRe">statementRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a></li><li class="src short"><a href="#v:exploitRe">exploitRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a></li><li class="src short"><a href="#v:findInjection">findInjection</a> :: <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a> -&gt; <a href="../base-4.13.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SQLExpr" class="def">SQLExpr</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#SQLExpr" class="link">Source</a> <a href="#t:SQLExpr" class="selflink">#</a></p><div class="doc"><p>Simple expression language</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Query" class="def">Query</a> <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Const" class="def">Const</a> <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Concat" class="def">Concat</a> <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a> <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:ReadVar" class="def">ReadVar</a> <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:SQLExpr">Instances</h4><details id="i:SQLExpr" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SQLExpr:IsString:1"></span> <a href="../base-4.13.0.0/Data-String.html#t:IsString" title="Data.String">IsString</a> <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a></span> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#line-39" class="link">Source</a> <a href="#t:SQLExpr" class="selflink">#</a></td><td class="doc"><p>Literals strings can be lifted to be constant programs</p></td></tr><tr><td colspan="2"><details id="i:id:SQLExpr:IsString:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Documentation-SBV-Examples-Strings-SQLInjection.html">Documentation.SBV.Examples.Strings.SQLInjection</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fromString">fromString</a> :: <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a> <a href="#v:fromString" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:M" class="def">M</a> = <a href="../mtl-2.2.2/Control-Monad-State-Lazy.html#t:StateT" title="Control.Monad.State.Lazy">StateT</a> (<a href="Data-SBV-Internals.html#t:SFunArray" title="Data.SBV.Internals">SFunArray</a> <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a>) (<a href="../mtl-2.2.2/Control-Monad-Writer-Lazy.html#t:WriterT" title="Control.Monad.Writer.Lazy">WriterT</a> [<a href="Data-SBV-Internals.html#t:SString" title="Data.SBV.Internals">SString</a>] <a href="Data-SBV-Internals.html#t:Symbolic" title="Data.SBV.Internals">Symbolic</a>) <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#M" class="link">Source</a> <a href="#t:M" class="selflink">#</a></p><div class="doc"><p>Evaluation monad. The state argument is the environment to store
 variables as we evaluate.</p></div></div><div class="top"><p class="src"><a id="v:eval" class="def">eval</a> :: <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a> -&gt; <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:M" title="Documentation.SBV.Examples.Strings.SQLInjection">M</a> <a href="Data-SBV-Internals.html#t:SString" title="Data.SBV.Internals">SString</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#eval" class="link">Source</a> <a href="#v:eval" class="selflink">#</a></p><div class="doc"><p>Given an expression, symbolically evaluate it</p></div></div><div class="top"><p class="src"><a id="v:exampleProgram" class="def">exampleProgram</a> :: <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#exampleProgram" class="link">Source</a> <a href="#v:exampleProgram" class="selflink">#</a></p><div class="doc"><p>A simple program to query all messages with a given topic id. In SQL like notation:</p><pre>  query (&quot;SELECT msg FROM msgs where topicid='&quot; ++ my_topicid ++ &quot;'&quot;)
</pre></div></div><div class="top"><p class="src"><a id="v:nameRe" class="def">nameRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#nameRe" class="link">Source</a> <a href="#v:nameRe" class="selflink">#</a></p><div class="doc"><p>Limit names to be at most 7 chars long, with simple letters.</p></div></div><div class="top"><p class="src"><a id="v:strRe" class="def">strRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#strRe" class="link">Source</a> <a href="#v:strRe" class="selflink">#</a></p><div class="doc"><p>Strings: Again, at most of lenght 5, surrounded by quotes.</p></div></div><div class="top"><p class="src"><a id="v:selectRe" class="def">selectRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#selectRe" class="link">Source</a> <a href="#v:selectRe" class="selflink">#</a></p><div class="doc"><p>A &quot;select&quot; command:</p></div></div><div class="top"><p class="src"><a id="v:dropRe" class="def">dropRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#dropRe" class="link">Source</a> <a href="#v:dropRe" class="selflink">#</a></p><div class="doc"><p>A &quot;drop&quot; instruction, which can be exploited!</p></div></div><div class="top"><p class="src"><a id="v:statementRe" class="def">statementRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#statementRe" class="link">Source</a> <a href="#v:statementRe" class="selflink">#</a></p><div class="doc"><p>We'll greatly simplify here and say a statement is either a select or a drop:</p></div></div><div class="top"><p class="src"><a id="v:exploitRe" class="def">exploitRe</a> :: <a href="Data-SBV-RegExp.html#t:RegExp" title="Data.SBV.RegExp">RegExp</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#exploitRe" class="link">Source</a> <a href="#v:exploitRe" class="selflink">#</a></p><div class="doc"><p>The exploit: We're looking for a DROP TABLE after at least one legitimate command.</p></div></div><div class="top"><p class="src"><a id="v:findInjection" class="def">findInjection</a> :: <a href="Documentation-SBV-Examples-Strings-SQLInjection.html#t:SQLExpr" title="Documentation.SBV.Examples.Strings.SQLInjection">SQLExpr</a> -&gt; <a href="../base-4.13.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="src/Documentation.SBV.Examples.Strings.SQLInjection.html#findInjection" class="link">Source</a> <a href="#v:findInjection" class="selflink">#</a></p><div class="doc"><p>Analyze the program for inputs which result in a SQL injection. There are
 other possible injections, but in this example we're only looking for a
 <code>DROP TABLE</code> command.</p><p>Remember that our example program (in pseudo-code) is:</p><pre>  query (&quot;SELECT msg FROM msgs WHERE topicid='&quot; ++ my_topicid ++ &quot;'&quot;)
</pre><p>Depending on your z3 version, you might see an output of the form:</p><pre>  ghci&gt; findInjection exampleProgram
  &quot;kg'; DROP TABLE 'users&quot;
</pre><p>though the topic might change obviously. Indeed, if we substitute the suggested string, we get the program:</p><pre>query (&quot;SELECT msg FROM msgs WHERE topicid='kg'; DROP TABLE 'users'&quot;)</pre><p>which would query for topic <code>kg</code> and then delete the users table!</p><p>Here, we make sure that the injection ends with the malicious string:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>(&quot;'; DROP TABLE 'users&quot; `Data.List.isSuffixOf`) &lt;$&gt; findInjection exampleProgram
</code></strong>True
</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>