<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Documentation.SBV.Examples.Crypto.RC4</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">sbv-8.6: SMT Based Verification: Symbolic Haskell theorem prover using SMT solving.</span><ul class="links" id="page-menu"><li><a href="src/Documentation.SBV.Examples.Crypto.RC4.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) Austin Seipp</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>erkokl@gmail.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Documentation.SBV.Examples.Crypto.RC4</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Types</a></li><li><a href="#g:2">The PRGA</a></li><li><a href="#g:3">Key schedule</a></li><li><a href="#g:4">Encryption and Decryption</a></li><li><a href="#g:5">Verification</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>An implementation of RC4 (AKA Rivest Cipher 4 or Alleged RC4/ARC4),
 using SBV. For information on RC4, see: <a href="http://en.wikipedia.org/wiki/RC4">http://en.wikipedia.org/wiki/RC4</a>.</p><p>We make no effort to optimize the code, and instead focus on a clear
 implementation. In fact, the RC4 algorithm relies on in-place update of
 its state heavily for efficiency, and is therefore unsuitable for a purely
 functional implementation.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">type</span> <a href="#t:S">S</a> = <a href="Data-SBV-Tools-STree.html#t:STree" title="Data.SBV.Tools.STree">STree</a> <a href="../base-4.13.0.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="../base-4.13.0.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></li><li class="src short"><a href="#v:initS">initS</a> :: <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:Key">Key</a> = [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>]</li><li class="src short"><span class="keyword">type</span> <a href="#t:RC4">RC4</a> = (<a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a>, <a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>, <a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>)</li><li class="src short"><a href="#v:swap">swap</a> :: <a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a> -&gt; <a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a> -&gt; <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a> -&gt; <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a></li><li class="src short"><a href="#v:prga">prga</a> :: <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:RC4" title="Documentation.SBV.Examples.Crypto.RC4">RC4</a> -&gt; (<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>, <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:RC4" title="Documentation.SBV.Examples.Crypto.RC4">RC4</a>)</li><li class="src short"><a href="#v:initRC4">initRC4</a> :: <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:Key" title="Documentation.SBV.Examples.Crypto.RC4">Key</a> -&gt; <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a></li><li class="src short"><a href="#v:keySchedule">keySchedule</a> :: <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:Key" title="Documentation.SBV.Examples.Crypto.RC4">Key</a> -&gt; [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>]</li><li class="src short"><a href="#v:keyScheduleString">keyScheduleString</a> :: <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>]</li><li class="src short"><a href="#v:encrypt">encrypt</a> :: <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>]</li><li class="src short"><a href="#v:decrypt">decrypt</a> :: <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>] -&gt; <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a></li><li class="src short"><a href="#v:rc4IsCorrect">rc4IsCorrect</a> :: <a href="../base-4.13.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Data-SBV-Trans.html#t:ThmResult" title="Data.SBV.Trans">ThmResult</a></li><li class="src short"><a href="#v:hex2">hex2</a> :: (<a href="Data-SBV-Internals.html#t:SymVal" title="Data.SBV.Internals">SymVal</a> a, <a href="../base-4.13.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a, <a href="../base-4.13.0.0/Prelude.html#t:Integral" title="Prelude">Integral</a> a) =&gt; <a href="Data-SBV-Internals.html#t:SBV" title="Data.SBV.Internals">SBV</a> a -&gt; <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Types</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:S" class="def">S</a> = <a href="Data-SBV-Tools-STree.html#t:STree" title="Data.SBV.Tools.STree">STree</a> <a href="../base-4.13.0.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="../base-4.13.0.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#S" class="link">Source</a> <a href="#t:S" class="selflink">#</a></p><div class="doc"><p>RC4 State contains 256 8-bit values. We use the symbolically accessible
 full-binary type <code><a href="Data-SBV-Tools-STree.html#t:STree" title="Data.SBV.Tools.STree">STree</a></code> to represent the state, since RC4 needs
 access to the array via a symbolic index and it's important to minimize access time.</p></div></div><div class="top"><p class="src"><a id="v:initS" class="def">initS</a> :: <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a> <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#initS" class="link">Source</a> <a href="#v:initS" class="selflink">#</a></p><div class="doc"><p>Construct the fully balanced initial tree, where the leaves are simply the numbers <code>0</code> through <code>255</code>.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Key" class="def">Key</a> = [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>] <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#Key" class="link">Source</a> <a href="#t:Key" class="selflink">#</a></p><div class="doc"><p>The key is a stream of <code><a href="../base-4.13.0.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></code> values.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:RC4" class="def">RC4</a> = (<a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a>, <a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>, <a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>) <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#RC4" class="link">Source</a> <a href="#t:RC4" class="selflink">#</a></p><div class="doc"><p>Represents the current state of the RC4 stream: it is the <code>S</code> array
 along with the <code>i</code> and <code>j</code> index values used by the PRGA.</p></div></div><a href="#g:2" id="g:2"><h1>The PRGA</h1></a><div class="top"><p class="src"><a id="v:swap" class="def">swap</a> :: <a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a> -&gt; <a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a> -&gt; <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a> -&gt; <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a> <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#swap" class="link">Source</a> <a href="#v:swap" class="selflink">#</a></p><div class="doc"><p>Swaps two elements in the RC4 array.</p></div></div><div class="top"><p class="src"><a id="v:prga" class="def">prga</a> :: <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:RC4" title="Documentation.SBV.Examples.Crypto.RC4">RC4</a> -&gt; (<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>, <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:RC4" title="Documentation.SBV.Examples.Crypto.RC4">RC4</a>) <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#prga" class="link">Source</a> <a href="#v:prga" class="selflink">#</a></p><div class="doc"><p>Implements the PRGA used in RC4. We return the new state and the next key value generated.</p></div></div><a href="#g:3" id="g:3"><h1>Key schedule</h1></a><div class="top"><p class="src"><a id="v:initRC4" class="def">initRC4</a> :: <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:Key" title="Documentation.SBV.Examples.Crypto.RC4">Key</a> -&gt; <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:S" title="Documentation.SBV.Examples.Crypto.RC4">S</a> <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#initRC4" class="link">Source</a> <a href="#v:initRC4" class="selflink">#</a></p><div class="doc"><p>Constructs the state to be used by the PRGA using the given key.</p></div></div><div class="top"><p class="src"><a id="v:keySchedule" class="def">keySchedule</a> :: <a href="Documentation-SBV-Examples-Crypto-RC4.html#t:Key" title="Documentation.SBV.Examples.Crypto.RC4">Key</a> -&gt; [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>] <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#keySchedule" class="link">Source</a> <a href="#v:keySchedule" class="selflink">#</a></p><div class="doc"><p>The key-schedule. Note that this function returns an infinite list.</p></div></div><div class="top"><p class="src"><a id="v:keyScheduleString" class="def">keyScheduleString</a> :: <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>] <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#keyScheduleString" class="link">Source</a> <a href="#v:keyScheduleString" class="selflink">#</a></p><div class="doc"><p>Generate a key-schedule from a given key-string.</p></div></div><a href="#g:4" id="g:4"><h1>Encryption and Decryption</h1></a><div class="top"><p class="src"><a id="v:encrypt" class="def">encrypt</a> :: <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>] <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#encrypt" class="link">Source</a> <a href="#v:encrypt" class="selflink">#</a></p><div class="doc"><p>RC4 encryption. We generate key-words and xor it with the input. The
 following test-vectors are from Wikipedia <a href="http://en.wikipedia.org/wiki/RC4">http://en.wikipedia.org/wiki/RC4</a>:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>concatMap hex2 $ encrypt &quot;Key&quot; &quot;Plaintext&quot;
</code></strong>&quot;bbf316e8d940af0ad3&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>concatMap hex2 $ encrypt &quot;Wiki&quot; &quot;pedia&quot;
</code></strong>&quot;1021bf0420&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>concatMap hex2 $ encrypt &quot;Secret&quot; &quot;Attack at dawn&quot;
</code></strong>&quot;45a01f645fc35b383552544b9bf5&quot;
</pre></div></div><div class="top"><p class="src"><a id="v:decrypt" class="def">decrypt</a> :: <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; [<a href="Data-SBV-Internals.html#t:SWord8" title="Data.SBV.Internals">SWord8</a>] -&gt; <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#decrypt" class="link">Source</a> <a href="#v:decrypt" class="selflink">#</a></p><div class="doc"><p>RC4 decryption. Essentially the same as decryption. For the above test vectors we have:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>decrypt &quot;Key&quot; [0xbb, 0xf3, 0x16, 0xe8, 0xd9, 0x40, 0xaf, 0x0a, 0xd3]
</code></strong>&quot;Plaintext&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>decrypt &quot;Wiki&quot; [0x10, 0x21, 0xbf, 0x04, 0x20]
</code></strong>&quot;pedia&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>decrypt &quot;Secret&quot; [0x45, 0xa0, 0x1f, 0x64, 0x5f, 0xc3, 0x5b, 0x38, 0x35, 0x52, 0x54, 0x4b, 0x9b, 0xf5]
</code></strong>&quot;Attack at dawn&quot;
</pre></div></div><a href="#g:5" id="g:5"><h1>Verification</h1></a><div class="top"><p class="src"><a id="v:rc4IsCorrect" class="def">rc4IsCorrect</a> :: <a href="../base-4.13.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Data-SBV-Trans.html#t:ThmResult" title="Data.SBV.Trans">ThmResult</a> <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#rc4IsCorrect" class="link">Source</a> <a href="#v:rc4IsCorrect" class="selflink">#</a></p><div class="doc"><p>Prove that round-trip encryption/decryption leaves the plain-text unchanged.
 The theorem is stated parametrically over key and plain-text sizes. The expression
 performs the proof for a 40-bit key (5 bytes) and 40-bit plaintext (again 5 bytes).</p><p>Note that this theorem is trivial to prove, since it is essentially establishing
 xor'in the same value twice leaves a word unchanged (i.e., <code>x <code><a href="../base-4.13.0.0/Data-Bits.html#v:xor" title="Data.Bits">xor</a></code> y <code><a href="../base-4.13.0.0/Data-Bits.html#v:xor" title="Data.Bits">xor</a></code> y = x</code>).
 However, the proof takes quite a while to complete, as it gives rise to a fairly
 large symbolic trace.</p></div></div><div class="top"><p class="src"><a id="v:hex2" class="def">hex2</a> :: (<a href="Data-SBV-Internals.html#t:SymVal" title="Data.SBV.Internals">SymVal</a> a, <a href="../base-4.13.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a, <a href="../base-4.13.0.0/Prelude.html#t:Integral" title="Prelude">Integral</a> a) =&gt; <a href="Data-SBV-Internals.html#t:SBV" title="Data.SBV.Internals">SBV</a> a -&gt; <a href="../base-4.13.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="src/Documentation.SBV.Examples.Crypto.RC4.html#hex2" class="link">Source</a> <a href="#v:hex2" class="selflink">#</a></p><div class="doc"><p>For doctest purposes only</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>