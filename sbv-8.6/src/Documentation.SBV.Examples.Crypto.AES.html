<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Module    : Documentation.SBV.Examples.Crypto.AES</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Copyright : (c) Levent Erkok</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- License   : BSD3</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Maintainer: erkokl@gmail.com</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Stability : experimental</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- An implementation of AES (Advanced Encryption Standard), using SBV.</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- For details on AES, see &lt;http://en.wikipedia.org/wiki/Advanced_Encryption_Standard&gt;.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- We do a T-box implementation, which leads to good C code as we can take</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- advantage of look-up tables. Note that we make virtually no attempt to</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- optimize our Haskell code. The concern here is not with getting Haskell running</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- fast at all. The idea is to program the T-Box implementation as naturally and clearly</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- as possible in Haskell, and have SBV's code-generator generate fast C code automatically.</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- Therefore, we merely use ordinary Haskell lists as our data-structures, and do not</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- bother with any unboxing or strictness annotations. Thus, we achieve the separation</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- of concerns: Correctness via clairty and simplicity and proofs on the Haskell side,</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- performance by relying on SBV's code generator. If necessary, the generated code</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- can be FFI'd back into Haskell to complete the loop.</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- All 3 valid key sizes (128, 192, and 256) as required by the FIPS-197 standard</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- are supported.</span><span>
</span><span id="line-25"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-pragma">{-# LANGUAGE DataKinds        #-}</span><span>
</span><span id="line-28"></span><span class="hs-pragma">{-# LANGUAGE ParallelListComp #-}</span><span>
</span><span id="line-29"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wall -Werror #-}</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Documentation.SBV.Examples.Crypto.AES</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.SBV.html"><span class="hs-identifier">Data.SBV</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.SBV.Tools.CodeGen.html"><span class="hs-identifier">Data.SBV.Tools.CodeGen</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.SBV.Tools.Polynomial.html"><span class="hs-identifier">Data.SBV.Tools.Polynomial</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">transpose</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">showHex</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- * Formalizing GF(2^8)</span><span>
</span><span id="line-48"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">-- | An element of the Galois Field 2^8, which are essentially polynomials with</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- maximum degree 7. They are conveniently represented as values between 0 and 255.</span><span>
</span><span id="line-52"></span><span class="hs-keyword">type</span><span> </span><span id="GF28"><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-var">GF28</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- | Multiplication in GF(2^8). This is simple polynomial multipliation, followed</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- by the irreducible polynomial @x^8+x^4+x^3+x^1+1@. We simply use the 'pMult'</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- function exported by SBV to do the operation. </span><span>
</span><span id="line-57"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-identifier hs-type">gf28Mult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span>
</span><span id="line-58"></span><span id="gf28Mult"><span class="annot"><span class="annottext">gf28Mult :: GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-identifier hs-var hs-var">gf28Mult</span></a></span></span><span> </span><span id="local-6989586621681160894"><span class="annot"><span class="annottext">x :: GF28
</span><a href="#local-6989586621681160894"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681160893"><span class="annot"><span class="annottext">y :: GF28
</span><a href="#local-6989586621681160893"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GF28, GF28, [Int]) -&gt; GF28
forall a. Polynomial a =&gt; (a, a, [Int]) -&gt; a
</span><a href="Data.SBV.Tools.Polynomial.html#pMult"><span class="hs-identifier hs-var">pMult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160894"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160893"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Exponentiation by a constant in GF(2^8). The implementation uses the usual</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- square-and-multiply trick to speed up the computation.</span><span>
</span><span id="line-62"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Pow"><span class="hs-identifier hs-type">gf28Pow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span>
</span><span id="line-63"></span><span id="gf28Pow"><span class="annot"><span class="annottext">gf28Pow :: GF28 -&gt; Int -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Pow"><span class="hs-identifier hs-var hs-var">gf28Pow</span></a></span></span><span> </span><span id="local-6989586621681160890"><span class="annot"><span class="annottext">n :: GF28
</span><a href="#local-6989586621681160890"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; GF28
forall a. (Integral a, Bits a) =&gt; a -&gt; GF28
</span><a href="#local-6989586621681160889"><span class="hs-identifier hs-var">pow</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160888"><span class="annot"><span class="annottext">sq :: GF28 -&gt; GF28
</span><a href="#local-6989586621681160888"><span class="hs-identifier hs-var hs-var">sq</span></a></span></span><span> </span><span id="local-6989586621681160887"><span class="annot"><span class="annottext">x :: GF28
</span><a href="#local-6989586621681160887"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160887"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-operator hs-var">`gf28Mult`</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160887"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-65"></span><span>        </span><span id="local-6989586621681160889"><span class="annot"><span class="annottext">pow :: a -&gt; GF28
</span><a href="#local-6989586621681160889"><span class="hs-identifier hs-var hs-var">pow</span></a></span></span><span> </span><span class="hs-number">0</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-66"></span><span>        </span><span class="annot"><a href="#local-6989586621681160889"><span class="hs-identifier hs-var">pow</span></a></span><span> </span><span id="local-6989586621681160886"><span class="annot"><span class="annottext">i :: a
</span><a href="#local-6989586621681160886"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-67"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
forall a. Integral a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">odd</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681160886"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160890"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-operator hs-var">`gf28Mult`</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160888"><span class="hs-identifier hs-var">sq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; GF28
</span><a href="#local-6989586621681160889"><span class="hs-identifier hs-var">pow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681160886"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160888"><span class="hs-identifier hs-var">sq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; GF28
</span><a href="#local-6989586621681160889"><span class="hs-identifier hs-var">pow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681160886"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Computing inverses in GF(2^8). By the mathematical properties of GF(2^8)</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- and the particular irreducible polynomial used @x^8+x^5+x^3+x^1+1@, it</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- turns out that raising to the 254 power gives us the multiplicative inverse.</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- Of course, we can prove this using SBV:</span><span>
</span><span id="line-74"></span><span class="hs-comment">--</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- &gt;&gt;&gt; prove $ \x -&gt; x ./= 0 .=&gt; x `gf28Mult` gf28Inverse x .== 1</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- Q.E.D.</span><span>
</span><span id="line-77"></span><span class="hs-comment">--</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- Note that we exclude @0@ in our theorem, as it does not have a</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- multiplicative inverse.</span><span>
</span><span id="line-80"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Inverse"><span class="hs-identifier hs-type">gf28Inverse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span>
</span><span id="line-81"></span><span id="gf28Inverse"><span class="annot"><span class="annottext">gf28Inverse :: GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Inverse"><span class="hs-identifier hs-var hs-var">gf28Inverse</span></a></span></span><span> </span><span id="local-6989586621681160882"><span class="annot"><span class="annottext">x :: GF28
</span><a href="#local-6989586621681160882"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160882"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; Int -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Pow"><span class="hs-operator hs-var">`gf28Pow`</span></a></span><span> </span><span class="annot"><span class="hs-number">254</span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- * Implementing AES</span><span>
</span><span id="line-85"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- ** Types and basic operations</span><span>
</span><span id="line-89"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | AES state. The state consists of four 32-bit words, each of which is in turn treated</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- as four GF28's, i.e., 4 bytes. The T-Box implementation keeps the four-bytes together</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- for efficient representation.</span><span>
</span><span id="line-93"></span><span class="hs-keyword">type</span><span> </span><span id="State"><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-var">State</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- | The key, which can be 128, 192, or 256 bits. Represented as a sequence of 32-bit words.</span><span>
</span><span id="line-96"></span><span class="hs-keyword">type</span><span> </span><span id="Key"><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-var">Key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | The key schedule. AES executes in rounds, and it treats first and last round keys slightly</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- differently than the middle ones. We reflect that choice by being explicit about it in our type.</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- The length of the middle list of keys depends on the key-size, which in turn determines</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- the number of rounds.</span><span>
</span><span id="line-102"></span><span class="hs-keyword">type</span><span> </span><span id="KS"><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#KS"><span class="hs-identifier hs-var">KS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Rotating a state row by a fixed amount to the right.</span><span>
</span><span id="line-105"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-identifier hs-type">rotR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-106"></span><span id="rotR"><span class="annot"><span class="annottext">rotR :: [GF28] -&gt; Int -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-identifier hs-var hs-var">rotR</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621681160879"><span class="annot"><span class="annottext">a :: GF28
</span><a href="#local-6989586621681160879"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160878"><span class="annot"><span class="annottext">b :: GF28
</span><a href="#local-6989586621681160878"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160877"><span class="annot"><span class="annottext">c :: GF28
</span><a href="#local-6989586621681160877"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160876"><span class="annot"><span class="annottext">d :: GF28
</span><a href="#local-6989586621681160876"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160876"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160879"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160878"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160877"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-107"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-identifier hs-var">rotR</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621681160875"><span class="annot"><span class="annottext">a :: GF28
</span><a href="#local-6989586621681160875"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160874"><span class="annot"><span class="annottext">b :: GF28
</span><a href="#local-6989586621681160874"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160873"><span class="annot"><span class="annottext">c :: GF28
</span><a href="#local-6989586621681160873"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160872"><span class="annot"><span class="annottext">d :: GF28
</span><a href="#local-6989586621681160872"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160873"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160872"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160875"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160874"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-identifier hs-var">rotR</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621681160871"><span class="annot"><span class="annottext">a :: GF28
</span><a href="#local-6989586621681160871"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160870"><span class="annot"><span class="annottext">b :: GF28
</span><a href="#local-6989586621681160870"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160869"><span class="annot"><span class="annottext">c :: GF28
</span><a href="#local-6989586621681160869"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160868"><span class="annot"><span class="annottext">d :: GF28
</span><a href="#local-6989586621681160868"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160870"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160869"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160868"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160871"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-109"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-identifier hs-var">rotR</span></a></span><span> </span><span id="local-6989586621681160867"><span class="annot"><span class="annottext">xs :: [GF28]
</span><a href="#local-6989586621681160867"><span class="hs-identifier hs-var">xs</span></a></span></span><span>           </span><span id="local-6989586621681160866"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621681160866"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [GF28]
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [GF28]) -&gt; [Char] -&gt; [GF28]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;rotR: Unexpected input: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">([GF28], Int) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GF28]
</span><a href="#local-6989586621681160867"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160866"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- ** The key schedule</span><span>
</span><span id="line-113"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | Definition of round-constants, as specified in Section 5.2 of the AES standard.</span><span>
</span><span id="line-116"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#roundConstants"><span class="hs-identifier hs-type">roundConstants</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span id="roundConstants"><span class="annot"><span class="annottext">roundConstants :: [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#roundConstants"><span class="hs-identifier hs-var hs-var">roundConstants</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; [GF28] -&gt; [GF28]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; Int -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Pow"><span class="hs-identifier hs-var">gf28Pow</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160862"><span class="hs-identifier hs-var">k</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160862"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160862"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- | The @InvMixColumns@ transformation, as described in Section 5.3.3 of the standard. Note</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- that this transformation is only used explicitly during key-expansion in the T-Box implementation</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- of AES.</span><span>
</span><span id="line-122"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#invMixColumns"><span class="hs-identifier hs-type">invMixColumns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span>
</span><span id="line-123"></span><span id="invMixColumns"><span class="annot"><span class="annottext">invMixColumns :: State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#invMixColumns"><span class="hs-identifier hs-var hs-var">invMixColumns</span></a></span></span><span> </span><span id="local-6989586621681160860"><span class="annot"><span class="annottext">state :: State
</span><a href="#local-6989586621681160860"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GF28] -&gt; SWord 32) -&gt; [[GF28]] -&gt; State
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="annot"><span class="annottext">([[GF28]] -&gt; State) -&gt; [[GF28]] -&gt; State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; [[GF28]]
forall a. [[a]] -&gt; [[a]]
</span><span class="hs-identifier hs-var">transpose</span></span><span> </span><span class="annot"><span class="annottext">([[GF28]] -&gt; [[GF28]]) -&gt; [[GF28]] -&gt; [[GF28]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; [[GF28]]
</span><a href="#local-6989586621681160858"><span class="hs-identifier hs-var">mmult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SWord 32 -&gt; [GF28]) -&gt; State -&gt; [[GF28]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; [GF28]
forall a. ByteConverter a =&gt; a -&gt; [GF28]
</span><a href="Data.SBV.Core.Sized.html#toBytes"><span class="hs-identifier hs-var">toBytes</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160860"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160856"><span class="annot"><span class="annottext">dot :: [a -&gt; c] -&gt; [a] -&gt; c
</span><a href="#local-6989586621681160856"><span class="hs-identifier hs-var hs-var">dot</span></a></span></span><span> </span><span id="local-6989586621681160855"><span class="annot"><span class="annottext">f :: [a -&gt; c]
</span><a href="#local-6989586621681160855"><span class="hs-identifier hs-var">f</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(c -&gt; c -&gt; c) -&gt; [c] -&gt; c
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">c -&gt; c -&gt; c
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">xor</span></span><span> </span><span class="annot"><span class="annottext">([c] -&gt; c) -&gt; ([a] -&gt; [c]) -&gt; [a] -&gt; c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((a -&gt; c) -&gt; a -&gt; c) -&gt; [a -&gt; c] -&gt; [a] -&gt; [c]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; c) -&gt; a -&gt; c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">($)</span></span><span> </span><span class="annot"><span class="annottext">[a -&gt; c]
</span><a href="#local-6989586621681160855"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-125"></span><span>       </span><span id="local-6989586621681160858"><span class="annot"><span class="annottext">mmult :: [[GF28]] -&gt; [[GF28]]
</span><a href="#local-6989586621681160858"><span class="hs-identifier hs-var hs-var">mmult</span></a></span></span><span> </span><span id="local-6989586621681160850"><span class="annot"><span class="annottext">n :: [[GF28]]
</span><a href="#local-6989586621681160850"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">([GF28] -&gt; GF28) -&gt; [[GF28]] -&gt; [GF28]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GF28 -&gt; GF28] -&gt; [GF28] -&gt; GF28
forall c a. Bits c =&gt; [a -&gt; c] -&gt; [a] -&gt; c
</span><a href="#local-6989586621681160856"><span class="hs-identifier hs-var">dot</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28 -&gt; GF28]
</span><a href="#local-6989586621681160849"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160850"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160849"><span class="annot"><span class="annottext">[GF28 -&gt; GF28]
</span><a href="#local-6989586621681160849"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160848"><span class="hs-identifier hs-var">mE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160847"><span class="hs-identifier hs-var">mB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160846"><span class="hs-identifier hs-var">mD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160845"><span class="hs-identifier hs-var">m9</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160845"><span class="hs-identifier hs-var">m9</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160848"><span class="hs-identifier hs-var">mE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160847"><span class="hs-identifier hs-var">mB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160846"><span class="hs-identifier hs-var">mD</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160846"><span class="hs-identifier hs-var">mD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160845"><span class="hs-identifier hs-var">m9</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160848"><span class="hs-identifier hs-var">mE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160847"><span class="hs-identifier hs-var">mB</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-128"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160847"><span class="hs-identifier hs-var">mB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160846"><span class="hs-identifier hs-var">mD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160845"><span class="hs-identifier hs-var">m9</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160848"><span class="hs-identifier hs-var">mE</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-129"></span><span>                                       </span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>       </span><span class="hs-comment">-- table-lookup versions of gf28Mult with the constants used in invMixColumns</span><span>
</span><span id="line-131"></span><span>       </span><span id="local-6989586621681160848"><span class="annot"><span class="annottext">mE :: GF28 -&gt; GF28
</span><a href="#local-6989586621681160848"><span class="hs-identifier hs-var hs-var">mE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; GF28 -&gt; GF28 -&gt; GF28
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28]
</span><a href="#local-6989586621681160843"><span class="hs-identifier hs-var">mETable</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-132"></span><span>       </span><span id="local-6989586621681160847"><span class="annot"><span class="annottext">mB :: GF28 -&gt; GF28
</span><a href="#local-6989586621681160847"><span class="hs-identifier hs-var hs-var">mB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; GF28 -&gt; GF28 -&gt; GF28
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28]
</span><a href="#local-6989586621681160842"><span class="hs-identifier hs-var">mBTable</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-133"></span><span>       </span><span id="local-6989586621681160846"><span class="annot"><span class="annottext">mD :: GF28 -&gt; GF28
</span><a href="#local-6989586621681160846"><span class="hs-identifier hs-var hs-var">mD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; GF28 -&gt; GF28 -&gt; GF28
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28]
</span><a href="#local-6989586621681160841"><span class="hs-identifier hs-var">mDTable</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-134"></span><span>       </span><span id="local-6989586621681160845"><span class="annot"><span class="annottext">m9 :: GF28 -&gt; GF28
</span><a href="#local-6989586621681160845"><span class="hs-identifier hs-var hs-var">m9</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; GF28 -&gt; GF28 -&gt; GF28
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28]
</span><a href="#local-6989586621681160840"><span class="hs-identifier hs-var">m9Table</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-135"></span><span>       </span><span id="local-6989586621681160843"><span class="annot"><span class="annottext">mETable :: [GF28]
</span><a href="#local-6989586621681160843"><span class="hs-identifier hs-var hs-var">mETable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GF28 -&gt; GF28) -&gt; [GF28] -&gt; [GF28]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-identifier hs-var">gf28Mult</span></a></span><span> </span><span class="annot"><span class="hs-number">0xE</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span>
</span><span id="line-136"></span><span>       </span><span id="local-6989586621681160842"><span class="annot"><span class="annottext">mBTable :: [GF28]
</span><a href="#local-6989586621681160842"><span class="hs-identifier hs-var hs-var">mBTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GF28 -&gt; GF28) -&gt; [GF28] -&gt; [GF28]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-identifier hs-var">gf28Mult</span></a></span><span> </span><span class="annot"><span class="hs-number">0xB</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span>
</span><span id="line-137"></span><span>       </span><span id="local-6989586621681160841"><span class="annot"><span class="annottext">mDTable :: [GF28]
</span><a href="#local-6989586621681160841"><span class="hs-identifier hs-var hs-var">mDTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GF28 -&gt; GF28) -&gt; [GF28] -&gt; [GF28]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-identifier hs-var">gf28Mult</span></a></span><span> </span><span class="annot"><span class="hs-number">0xD</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span>
</span><span id="line-138"></span><span>       </span><span id="local-6989586621681160840"><span class="annot"><span class="annottext">m9Table :: [GF28]
</span><a href="#local-6989586621681160840"><span class="hs-identifier hs-var hs-var">m9Table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GF28 -&gt; GF28) -&gt; [GF28] -&gt; [GF28]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-identifier hs-var">gf28Mult</span></a></span><span> </span><span class="annot"><span class="hs-number">0x9</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- | Key expansion. Starting with the given key, returns an infinite sequence of</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- words, as described by the AES standard, Section 5.2, Figure 11.</span><span>
</span><span id="line-142"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#keyExpansion"><span class="hs-identifier hs-type">keyExpansion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span id="keyExpansion"><span class="annot"><span class="annottext">keyExpansion :: Int -&gt; State -&gt; [State]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#keyExpansion"><span class="hs-identifier hs-var hs-var">keyExpansion</span></a></span></span><span> </span><span id="local-6989586621681160838"><span class="annot"><span class="annottext">nk :: Int
</span><a href="#local-6989586621681160838"><span class="hs-identifier hs-var">nk</span></a></span></span><span> </span><span id="local-6989586621681160837"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160837"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; [State]
forall a. [a] -&gt; [[a]]
</span><a href="#local-6989586621681160836"><span class="hs-identifier hs-var">chop4</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160835"><span class="hs-identifier hs-var">keys</span></a></span><span>
</span><span id="line-144"></span><span>   </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="#local-6989586621681160835"><span class="hs-identifier hs-type">keys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-145"></span><span>         </span><span id="local-6989586621681160835"><span class="annot"><span class="annottext">keys :: State
</span><a href="#local-6989586621681160835"><span class="hs-identifier hs-var hs-var">keys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160837"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; State
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; SWord 32 -&gt; SWord 32 -&gt; SWord 32
</span><a href="#local-6989586621681160834"><span class="hs-identifier hs-var">nextWord</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160833"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160832"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160831"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160833"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160833"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160838"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160832"><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160832"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; State -&gt; State
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160838"><span class="hs-identifier hs-var">nk</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160835"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160831"><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160831"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160835"><span class="hs-identifier hs-var">keys</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-146"></span><span>         </span><span id="local-6989586621681160935"><span class="annot"><a href="#local-6989586621681160836"><span class="hs-identifier hs-type">chop4</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681160935"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681160935"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span></span><span>
</span><span id="line-147"></span><span>         </span><span id="local-6989586621681160836"><span class="annot"><span class="annottext">chop4 :: [a] -&gt; [[a]]
</span><a href="#local-6989586621681160836"><span class="hs-identifier hs-var hs-var">chop4</span></a></span></span><span> </span><span id="local-6989586621681160829"><span class="annot"><span class="annottext">xs :: [a]
</span><a href="#local-6989586621681160829"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681160828"><span class="annot"><span class="annottext">f :: [a]
</span><a href="#local-6989586621681160828"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160827"><span class="annot"><span class="annottext">r :: [a]
</span><a href="#local-6989586621681160827"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [a] -&gt; ([a], [a])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681160829"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681160828"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [[a]] -&gt; [[a]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [[a]]
forall a. [a] -&gt; [[a]]
</span><a href="#local-6989586621681160836"><span class="hs-identifier hs-var">chop4</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681160827"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-148"></span><span>         </span><span class="annot"><a href="#local-6989586621681160834"><span class="hs-identifier hs-type">nextWord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-149"></span><span>         </span><span id="local-6989586621681160834"><span class="annot"><span class="annottext">nextWord :: Int -&gt; SWord 32 -&gt; SWord 32 -&gt; SWord 32
</span><a href="#local-6989586621681160834"><span class="hs-identifier hs-var hs-var">nextWord</span></a></span></span><span> </span><span id="local-6989586621681160825"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621681160825"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681160824"><span class="annot"><span class="annottext">prev :: SWord 32
</span><a href="#local-6989586621681160824"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span id="local-6989586621681160823"><span class="annot"><span class="annottext">old :: SWord 32
</span><a href="#local-6989586621681160823"><span class="hs-identifier hs-var">old</span></a></span></span><span>
</span><span id="line-150"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160825"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160838"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160823"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; GF28 -&gt; SWord 32
</span><a href="#local-6989586621681160821"><span class="hs-identifier hs-var">subWordRcon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160824"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; Int -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`rotateL`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#roundConstants"><span class="hs-identifier hs-var">roundConstants</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160825"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160838"><span class="hs-identifier hs-var">nk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160825"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160838"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160838"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">6</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160823"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; GF28 -&gt; SWord 32
</span><a href="#local-6989586621681160821"><span class="hs-identifier hs-var">subWordRcon</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160824"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-152"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160823"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160824"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-153"></span><span>         </span><span class="annot"><a href="#local-6989586621681160821"><span class="hs-identifier hs-type">subWordRcon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-154"></span><span>         </span><span id="local-6989586621681160821"><span class="annot"><span class="annottext">subWordRcon :: SWord 32 -&gt; GF28 -&gt; SWord 32
</span><a href="#local-6989586621681160821"><span class="hs-identifier hs-var hs-var">subWordRcon</span></a></span></span><span> </span><span id="local-6989586621681160815"><span class="annot"><span class="annottext">w :: SWord 32
</span><a href="#local-6989586621681160815"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681160814"><span class="annot"><span class="annottext">rc :: GF28
</span><a href="#local-6989586621681160814"><span class="hs-identifier hs-var">rc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160813"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160814"><span class="hs-identifier hs-var">rc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160812"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160811"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160810"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681160813"><span class="annot"><span class="annottext">a :: GF28
</span><a href="#local-6989586621681160813"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160812"><span class="annot"><span class="annottext">b :: GF28
</span><a href="#local-6989586621681160812"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160811"><span class="annot"><span class="annottext">c :: GF28
</span><a href="#local-6989586621681160811"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160810"><span class="annot"><span class="annottext">d :: GF28
</span><a href="#local-6989586621681160810"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GF28 -&gt; GF28) -&gt; [GF28] -&gt; [GF28]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-var">sbox</span></a></span><span> </span><span class="annot"><span class="annottext">([GF28] -&gt; [GF28]) -&gt; [GF28] -&gt; [GF28]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; [GF28]
forall a. ByteConverter a =&gt; a -&gt; [GF28]
</span><a href="Data.SBV.Core.Sized.html#toBytes"><span class="hs-identifier hs-var">toBytes</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160815"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- ** The S-box transformation</span><span>
</span><span id="line-159"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | The values of the AES S-box table. Note that we describe the S-box programmatically</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- using the mathematical construction given in Section 5.1.1 of the standard. However,</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- the code-generation will turn this into a mere look-up table, as it is just a</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- constant table, all computation being done at \&quot;compile-time\&quot;.</span><span>
</span><span id="line-165"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#sboxTable"><span class="hs-identifier hs-type">sboxTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span id="sboxTable"><span class="annot"><span class="annottext">sboxTable :: [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sboxTable"><span class="hs-identifier hs-var hs-var">sboxTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160807"><span class="hs-identifier hs-var">xformByte</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Inverse"><span class="hs-identifier hs-var">gf28Inverse</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160806"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160806"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160806"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="#local-6989586621681160807"><span class="hs-identifier hs-type">xformByte</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span id="local-6989586621681160807"><span class="annot"><span class="annottext">xformByte :: GF28 -&gt; GF28
</span><a href="#local-6989586621681160807"><span class="hs-identifier hs-var hs-var">xformByte</span></a></span></span><span> </span><span id="local-6989586621681160805"><span class="annot"><span class="annottext">b :: GF28
</span><a href="#local-6989586621681160805"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GF28 -&gt; GF28 -&gt; GF28) -&gt; GF28 -&gt; [GF28] -&gt; GF28
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">xor</span></span><span> </span><span class="annot"><span class="hs-number">0x63</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160805"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; Int -&gt; GF28
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`rotateR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160802"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160802"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160802"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">7</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-comment">-- | The sbox transformation. We simply select from the sbox table. Note that we</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- are obliged to give a default value (here @0@) to be used if the index is out-of-bounds</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- as required by SBV's 'select' function. However, that will never happen since</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- the table has all 256 elements in it.</span><span>
</span><span id="line-174"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-type">sbox</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span>
</span><span id="line-175"></span><span id="sbox"><span class="annot"><span class="annottext">sbox :: GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-var hs-var">sbox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; GF28 -&gt; GF28 -&gt; GF28
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sboxTable"><span class="hs-identifier hs-var">sboxTable</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- ** The inverse S-box transformation</span><span>
</span><span id="line-179"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- | The values of the inverse S-box table. Again, the construction is programmatic.</span><span>
</span><span id="line-182"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBoxTable"><span class="hs-identifier hs-type">unSBoxTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span id="unSBoxTable"><span class="annot"><span class="annottext">unSBoxTable :: [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBoxTable"><span class="hs-identifier hs-var hs-var">unSBoxTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Inverse"><span class="hs-identifier hs-var">gf28Inverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="#local-6989586621681160800"><span class="hs-identifier hs-var">xformByte</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160799"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160799"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160799"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="#local-6989586621681160800"><span class="hs-identifier hs-type">xformByte</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span id="local-6989586621681160800"><span class="annot"><span class="annottext">xformByte :: GF28 -&gt; GF28
</span><a href="#local-6989586621681160800"><span class="hs-identifier hs-var hs-var">xformByte</span></a></span></span><span> </span><span id="local-6989586621681160798"><span class="annot"><span class="annottext">b :: GF28
</span><a href="#local-6989586621681160798"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GF28 -&gt; GF28 -&gt; GF28) -&gt; GF28 -&gt; [GF28] -&gt; GF28
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">xor</span></span><span> </span><span class="annot"><span class="hs-number">0x05</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160798"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; Int -&gt; GF28
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`rotateR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160797"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160797"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160797"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">7</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">-- | The inverse s-box transformation.</span><span>
</span><span id="line-188"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBox"><span class="hs-identifier hs-type">unSBox</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span>
</span><span id="line-189"></span><span id="unSBox"><span class="annot"><span class="annottext">unSBox :: GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBox"><span class="hs-identifier hs-var hs-var">unSBox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; GF28 -&gt; GF28 -&gt; GF28
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBoxTable"><span class="hs-identifier hs-var">unSBoxTable</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- | Prove that the 'sbox' and 'unSBox' are inverses. We have:</span><span>
</span><span id="line-192"></span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- &gt;&gt;&gt; prove sboxInverseCorrect</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- Q.E.D.</span><span>
</span><span id="line-195"></span><span class="hs-comment">--</span><span>
</span><span id="line-196"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#sboxInverseCorrect"><span class="hs-identifier hs-type">sboxInverseCorrect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Data.html#SBool"><span class="hs-identifier hs-type">SBool</span></a></span><span>
</span><span id="line-197"></span><span id="sboxInverseCorrect"><span class="annot"><span class="annottext">sboxInverseCorrect :: GF28 -&gt; SBool
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sboxInverseCorrect"><span class="hs-identifier hs-var hs-var">sboxInverseCorrect</span></a></span></span><span> </span><span id="local-6989586621681160794"><span class="annot"><span class="annottext">x :: GF28
</span><a href="#local-6989586621681160794"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBox"><span class="hs-identifier hs-var">unSBox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-var">sbox</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160794"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; SBool
forall a. EqSymbolic a =&gt; a -&gt; a -&gt; SBool
</span><a href="Data.SBV.Core.Model.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160794"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SBool -&gt; SBool -&gt; SBool
</span><a href="Data.SBV.Core.Data.html#.%26%26"><span class="hs-operator hs-var">.&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-var">sbox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBox"><span class="hs-identifier hs-var">unSBox</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160794"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; SBool
forall a. EqSymbolic a =&gt; a -&gt; a -&gt; SBool
</span><a href="Data.SBV.Core.Model.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160794"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- ** AddRoundKey transformation</span><span>
</span><span id="line-201"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">-- | Adding the round-key to the current state. We simply exploit the fact</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- that addition is just xor in implementing this transformation.</span><span>
</span><span id="line-205"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#addRoundKey"><span class="hs-identifier hs-type">addRoundKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span>
</span><span id="line-206"></span><span id="addRoundKey"><span class="annot"><span class="annottext">addRoundKey :: State -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#addRoundKey"><span class="hs-identifier hs-var hs-var">addRoundKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SWord 32 -&gt; SWord 32 -&gt; SWord 32) -&gt; State -&gt; State -&gt; State
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">xor</span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- ** Tables for T-Box encryption</span><span>
</span><span id="line-210"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | T-box table generation function for encryption</span><span>
</span><span id="line-213"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t0Func"><span class="hs-identifier hs-type">t0Func</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span id="t0Func"><span class="annot"><span class="annottext">t0Func :: GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t0Func"><span class="hs-identifier hs-var hs-var">t0Func</span></a></span></span><span> </span><span id="local-6989586621681160789"><span class="annot"><span class="annottext">a :: GF28
</span><a href="#local-6989586621681160789"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160788"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-operator hs-var">`gf28Mult`</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160788"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160788"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160788"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-operator hs-var">`gf28Mult`</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160788"><span class="annot"><span class="annottext">s :: GF28
</span><a href="#local-6989586621681160788"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-var">sbox</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160789"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- | First look-up table used in encryption</span><span>
</span><span id="line-217"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t0"><span class="hs-identifier hs-type">t0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-218"></span><span id="t0"><span class="annot"><span class="annottext">t0 :: GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t0"><span class="hs-identifier hs-var hs-var">t0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; SWord 32 -&gt; GF28 -&gt; SWord 32
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160786"><span class="hs-identifier hs-var">t0Table</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160786"><span class="annot"><span class="annottext">t0Table :: State
</span><a href="#local-6989586621681160786"><span class="hs-identifier hs-var hs-var">t0Table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t0Func"><span class="hs-identifier hs-var">t0Func</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160785"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160785"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160785"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- | Second look-up table used in encryption</span><span>
</span><span id="line-221"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t1"><span class="hs-identifier hs-type">t1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-222"></span><span id="t1"><span class="annot"><span class="annottext">t1 :: GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t1"><span class="hs-identifier hs-var hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; SWord 32 -&gt; GF28 -&gt; SWord 32
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160783"><span class="hs-identifier hs-var">t1Table</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160783"><span class="annot"><span class="annottext">t1Table :: State
</span><a href="#local-6989586621681160783"><span class="hs-identifier hs-var hs-var">t1Table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t0Func"><span class="hs-identifier hs-var">t0Func</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160782"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-operator hs-var">`rotR`</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160782"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160782"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- | Third look-up table used in encryption</span><span>
</span><span id="line-225"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t2"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-226"></span><span id="t2"><span class="annot"><span class="annottext">t2 :: GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t2"><span class="hs-identifier hs-var hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; SWord 32 -&gt; GF28 -&gt; SWord 32
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160780"><span class="hs-identifier hs-var">t2Table</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160780"><span class="annot"><span class="annottext">t2Table :: State
</span><a href="#local-6989586621681160780"><span class="hs-identifier hs-var hs-var">t2Table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t0Func"><span class="hs-identifier hs-var">t0Func</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160779"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-operator hs-var">`rotR`</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160779"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160779"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- | Fourth look-up table used in encryption</span><span>
</span><span id="line-229"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t3"><span class="hs-identifier hs-type">t3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-230"></span><span id="t3"><span class="annot"><span class="annottext">t3 :: GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t3"><span class="hs-identifier hs-var hs-var">t3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; SWord 32 -&gt; GF28 -&gt; SWord 32
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160777"><span class="hs-identifier hs-var">t3Table</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160777"><span class="annot"><span class="annottext">t3Table :: State
</span><a href="#local-6989586621681160777"><span class="hs-identifier hs-var hs-var">t3Table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t0Func"><span class="hs-identifier hs-var">t0Func</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160776"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-operator hs-var">`rotR`</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160776"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160776"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- ** Tables for T-Box decryption</span><span>
</span><span id="line-234"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | T-box table generating function for decryption</span><span>
</span><span id="line-237"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#u0Func"><span class="hs-identifier hs-type">u0Func</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-238"></span><span id="u0Func"><span class="annot"><span class="annottext">u0Func :: GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u0Func"><span class="hs-identifier hs-var hs-var">u0Func</span></a></span></span><span> </span><span id="local-6989586621681160774"><span class="annot"><span class="annottext">a :: GF28
</span><a href="#local-6989586621681160774"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160773"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-operator hs-var">`gf28Mult`</span></a></span><span> </span><span class="annot"><span class="hs-number">0xE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160773"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-operator hs-var">`gf28Mult`</span></a></span><span> </span><span class="annot"><span class="hs-number">0x9</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160773"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-operator hs-var">`gf28Mult`</span></a></span><span> </span><span class="annot"><span class="hs-number">0xD</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160773"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#gf28Mult"><span class="hs-operator hs-var">`gf28Mult`</span></a></span><span> </span><span class="annot"><span class="hs-number">0xB</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160773"><span class="annot"><span class="annottext">s :: GF28
</span><a href="#local-6989586621681160773"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBox"><span class="hs-identifier hs-var">unSBox</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160774"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">-- | First look-up table used in decryption</span><span>
</span><span id="line-241"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#u0"><span class="hs-identifier hs-type">u0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-242"></span><span id="u0"><span class="annot"><span class="annottext">u0 :: GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u0"><span class="hs-identifier hs-var hs-var">u0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; SWord 32 -&gt; GF28 -&gt; SWord 32
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160771"><span class="hs-identifier hs-var">t0Table</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160771"><span class="annot"><span class="annottext">t0Table :: State
</span><a href="#local-6989586621681160771"><span class="hs-identifier hs-var hs-var">t0Table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u0Func"><span class="hs-identifier hs-var">u0Func</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160770"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160770"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160770"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- | Second look-up table used in decryption</span><span>
</span><span id="line-245"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#u1"><span class="hs-identifier hs-type">u1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-246"></span><span id="u1"><span class="annot"><span class="annottext">u1 :: GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u1"><span class="hs-identifier hs-var hs-var">u1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; SWord 32 -&gt; GF28 -&gt; SWord 32
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160768"><span class="hs-identifier hs-var">t1Table</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160768"><span class="annot"><span class="annottext">t1Table :: State
</span><a href="#local-6989586621681160768"><span class="hs-identifier hs-var hs-var">t1Table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u0Func"><span class="hs-identifier hs-var">u0Func</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160767"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-operator hs-var">`rotR`</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160767"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160767"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">-- | Third look-up table used in decryption</span><span>
</span><span id="line-249"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#u2"><span class="hs-identifier hs-type">u2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-250"></span><span id="u2"><span class="annot"><span class="annottext">u2 :: GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u2"><span class="hs-identifier hs-var hs-var">u2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; SWord 32 -&gt; GF28 -&gt; SWord 32
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160765"><span class="hs-identifier hs-var">t2Table</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160765"><span class="annot"><span class="annottext">t2Table :: State
</span><a href="#local-6989586621681160765"><span class="hs-identifier hs-var hs-var">t2Table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u0Func"><span class="hs-identifier hs-var">u0Func</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160764"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-operator hs-var">`rotR`</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160764"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160764"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- | Fourth look-up table used in decryption</span><span>
</span><span id="line-253"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#u3"><span class="hs-identifier hs-type">u3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#GF28"><span class="hs-identifier hs-type">GF28</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span>
</span><span id="line-254"></span><span id="u3"><span class="annot"><span class="annottext">u3 :: GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u3"><span class="hs-identifier hs-var hs-var">u3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; SWord 32 -&gt; GF28 -&gt; SWord 32
forall a b.
(Mergeable a, Ord b, SymVal b, Num b) =&gt;
[a] -&gt; a -&gt; SBV b -&gt; a
</span><a href="Data.SBV.Core.Model.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160762"><span class="hs-identifier hs-var">t3Table</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160762"><span class="annot"><span class="annottext">t3Table :: State
</span><a href="#local-6989586621681160762"><span class="hs-identifier hs-var hs-var">t3Table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GF28 -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u0Func"><span class="hs-identifier hs-var">u0Func</span></a></span><span> </span><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160761"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; [GF28]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#rotR"><span class="hs-operator hs-var">`rotR`</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160761"><span class="annot"><span class="annottext">GF28
</span><a href="#local-6989586621681160761"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- ** AES rounds</span><span>
</span><span id="line-258"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">-- | Generic round function. Given the function to perform one round, a key-schedule,</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- and a starting state, it performs the AES rounds.</span><span>
</span><span id="line-262"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#doRounds"><span class="hs-identifier hs-type">doRounds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#KS"><span class="hs-identifier hs-type">KS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span>
</span><span id="line-263"></span><span id="doRounds"><span class="annot"><span class="annottext">doRounds :: (Bool -&gt; State -&gt; State -&gt; State) -&gt; KS -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#doRounds"><span class="hs-identifier hs-var hs-var">doRounds</span></a></span></span><span> </span><span id="local-6989586621681160759"><span class="annot"><span class="annottext">rnd :: Bool -&gt; State -&gt; State -&gt; State
</span><a href="#local-6989586621681160759"><span class="hs-identifier hs-var">rnd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681160758"><span class="annot"><span class="annottext">ikey :: State
</span><a href="#local-6989586621681160758"><span class="hs-identifier hs-var">ikey</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160757"><span class="annot"><span class="annottext">rkeys :: [State]
</span><a href="#local-6989586621681160757"><span class="hs-identifier hs-var">rkeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160756"><span class="annot"><span class="annottext">fkey :: State
</span><a href="#local-6989586621681160756"><span class="hs-identifier hs-var">fkey</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681160755"><span class="annot"><span class="annottext">sIn :: State
</span><a href="#local-6989586621681160755"><span class="hs-identifier hs-var">sIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; State -&gt; State -&gt; State
</span><a href="#local-6989586621681160759"><span class="hs-identifier hs-var">rnd</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[State] -&gt; State
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[State]
</span><a href="#local-6989586621681160753"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160756"><span class="hs-identifier hs-var">fkey</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160752"><span class="annot"><span class="annottext">s0 :: State
</span><a href="#local-6989586621681160752"><span class="hs-identifier hs-var hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160758"><span class="hs-identifier hs-var">ikey</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#addRoundKey"><span class="hs-operator hs-var">`addRoundKey`</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160755"><span class="hs-identifier hs-var">sIn</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span id="local-6989586621681160753"><span class="annot"><span class="annottext">rs :: [State]
</span><a href="#local-6989586621681160753"><span class="hs-identifier hs-var hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160752"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; [State] -&gt; [State]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bool -&gt; State -&gt; State -&gt; State
</span><a href="#local-6989586621681160759"><span class="hs-identifier hs-var">rnd</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160751"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160750"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160751"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160751"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[State]
</span><a href="#local-6989586621681160753"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681160750"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160750"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[State]
</span><a href="#local-6989586621681160757"><span class="hs-identifier hs-var">rkeys</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">-- | One encryption round. The first argument indicates whether this is the final round</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- or not, in which case the construction is slightly different.</span><span>
</span><span id="line-269"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#aesRound"><span class="hs-identifier hs-type">aesRound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span>
</span><span id="line-270"></span><span id="aesRound"><span class="annot"><span class="annottext">aesRound :: Bool -&gt; State -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesRound"><span class="hs-identifier hs-var hs-var">aesRound</span></a></span></span><span> </span><span id="local-6989586621681160748"><span class="annot"><span class="annottext">isFinal :: Bool
</span><a href="#local-6989586621681160748"><span class="hs-identifier hs-var">isFinal</span></a></span></span><span> </span><span id="local-6989586621681160747"><span class="annot"><span class="annottext">s :: State
</span><a href="#local-6989586621681160747"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681160746"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160746"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160745"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#addRoundKey"><span class="hs-operator hs-var">`addRoundKey`</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160746"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160745"><span class="annot"><span class="annottext">d :: State
</span><a href="#local-6989586621681160745"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; SWord 32) -&gt; [Int] -&gt; State
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; SWord 32
</span><a href="#local-6989586621681160744"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681160748"><span class="hs-identifier hs-var">isFinal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">]</span><span>
</span><span id="line-272"></span><span>        </span><span id="local-6989586621681160743"><span class="annot"><span class="annottext">a :: [[GF28]]
</span><a href="#local-6989586621681160743"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SWord 32 -&gt; [GF28]) -&gt; State -&gt; [[GF28]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; [GF28]
forall a. ByteConverter a =&gt; a -&gt; [GF28]
</span><a href="Data.SBV.Core.Sized.html#toBytes"><span class="hs-identifier hs-var">toBytes</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160747"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span id="local-6989586621681160744"><span class="annot"><span class="annottext">f :: Bool -&gt; Int -&gt; SWord 32
</span><a href="#local-6989586621681160744"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span id="local-6989586621681160742"><span class="annot"><span class="annottext">j :: Int
</span><a href="#local-6989586621681160742"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-var">sbox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160743"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160742"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-var">sbox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160743"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160742"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-var">sbox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160743"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160742"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#sbox"><span class="hs-identifier hs-var">sbox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160743"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160742"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><a href="#local-6989586621681160744"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span id="local-6989586621681160740"><span class="annot"><span class="annottext">j :: Int
</span><a href="#local-6989586621681160740"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160739"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160738"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160737"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160736"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-279"></span><span>              </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160739"><span class="annot"><span class="annottext">e0 :: SWord 32
</span><a href="#local-6989586621681160739"><span class="hs-identifier hs-var hs-var">e0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t0"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160743"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160740"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>                    </span><span id="local-6989586621681160738"><span class="annot"><span class="annottext">e1 :: SWord 32
</span><a href="#local-6989586621681160738"><span class="hs-identifier hs-var hs-var">e1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t1"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160743"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160740"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>                    </span><span id="local-6989586621681160737"><span class="annot"><span class="annottext">e2 :: SWord 32
</span><a href="#local-6989586621681160737"><span class="hs-identifier hs-var hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t2"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160743"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160740"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>                    </span><span id="local-6989586621681160736"><span class="annot"><span class="annottext">e3 :: SWord 32
</span><a href="#local-6989586621681160736"><span class="hs-identifier hs-var hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t3"><span class="hs-identifier hs-var">t3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160743"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160740"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">-- | One decryption round. Similar to the encryption round, the first argument</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- indicates whether this is the final round or not.</span><span>
</span><span id="line-286"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#aesInvRound"><span class="hs-identifier hs-type">aesInvRound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#State"><span class="hs-identifier hs-type">State</span></a></span><span>
</span><span id="line-287"></span><span id="aesInvRound"><span class="annot"><span class="annottext">aesInvRound :: Bool -&gt; State -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesInvRound"><span class="hs-identifier hs-var hs-var">aesInvRound</span></a></span></span><span> </span><span id="local-6989586621681160734"><span class="annot"><span class="annottext">isFinal :: Bool
</span><a href="#local-6989586621681160734"><span class="hs-identifier hs-var">isFinal</span></a></span></span><span> </span><span id="local-6989586621681160733"><span class="annot"><span class="annottext">s :: State
</span><a href="#local-6989586621681160733"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681160732"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160732"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160731"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#addRoundKey"><span class="hs-operator hs-var">`addRoundKey`</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160732"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160731"><span class="annot"><span class="annottext">d :: State
</span><a href="#local-6989586621681160731"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; SWord 32) -&gt; [Int] -&gt; State
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; SWord 32
</span><a href="#local-6989586621681160730"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681160734"><span class="hs-identifier hs-var">isFinal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">]</span><span>
</span><span id="line-289"></span><span>        </span><span id="local-6989586621681160729"><span class="annot"><span class="annottext">a :: [[GF28]]
</span><a href="#local-6989586621681160729"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SWord 32 -&gt; [GF28]) -&gt; State -&gt; [[GF28]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; [GF28]
forall a. ByteConverter a =&gt; a -&gt; [GF28]
</span><a href="Data.SBV.Core.Sized.html#toBytes"><span class="hs-identifier hs-var">toBytes</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160733"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span id="local-6989586621681160730"><span class="annot"><span class="annottext">f :: Bool -&gt; Int -&gt; SWord 32
</span><a href="#local-6989586621681160730"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span id="local-6989586621681160728"><span class="annot"><span class="annottext">j :: Int
</span><a href="#local-6989586621681160728"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; SWord 32
forall a. ByteConverter a =&gt; [GF28] -&gt; a
</span><a href="Data.SBV.Core.Sized.html#fromBytes"><span class="hs-identifier hs-var">fromBytes</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBox"><span class="hs-identifier hs-var">unSBox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160729"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160728"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBox"><span class="hs-identifier hs-var">unSBox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160729"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160728"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBox"><span class="hs-identifier hs-var">unSBox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160729"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160728"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; GF28
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#unSBox"><span class="hs-identifier hs-var">unSBox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160729"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160728"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-295"></span><span>        </span><span class="annot"><a href="#local-6989586621681160730"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span id="local-6989586621681160727"><span class="annot"><span class="annottext">j :: Int
</span><a href="#local-6989586621681160727"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160726"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160725"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160724"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">SWord 32 -&gt; SWord 32 -&gt; SWord 32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160723"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-296"></span><span>              </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160726"><span class="annot"><span class="annottext">e0 :: SWord 32
</span><a href="#local-6989586621681160726"><span class="hs-identifier hs-var hs-var">e0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u0"><span class="hs-identifier hs-var">u0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160729"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160727"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>                    </span><span id="local-6989586621681160725"><span class="annot"><span class="annottext">e1 :: SWord 32
</span><a href="#local-6989586621681160725"><span class="hs-identifier hs-var hs-var">e1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u1"><span class="hs-identifier hs-var">u1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160729"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160727"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                    </span><span id="local-6989586621681160724"><span class="annot"><span class="annottext">e2 :: SWord 32
</span><a href="#local-6989586621681160724"><span class="hs-identifier hs-var hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u2"><span class="hs-identifier hs-var">u2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160729"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160727"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>                    </span><span id="local-6989586621681160723"><span class="annot"><span class="annottext">e3 :: SWord 32
</span><a href="#local-6989586621681160723"><span class="hs-identifier hs-var hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GF28 -&gt; SWord 32
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#u3"><span class="hs-identifier hs-var">u3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[GF28]]
</span><a href="#local-6989586621681160729"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[[GF28]] -&gt; Int -&gt; [GF28]
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160727"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GF28] -&gt; Int -&gt; GF28
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- * AES API</span><span>
</span><span id="line-303"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">-- | Key schedule. Given a 128, 192, or 256 bit key, expand it to get key-schedules</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- for encryption and decryption. The key is given as a sequence of 32-bit words.</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- (4 elements for 128-bits, 6 for 192, and 8 for 256.)</span><span>
</span><span id="line-308"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-type">aesKeySchedule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#KS"><span class="hs-identifier hs-type">KS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#KS"><span class="hs-identifier hs-type">KS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span id="aesKeySchedule"><span class="annot"><span class="annottext">aesKeySchedule :: State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var hs-var">aesKeySchedule</span></a></span></span><span> </span><span id="local-6989586621681160721"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160721"><span class="hs-identifier hs-var">key</span></a></span></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160720"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">]</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160718"><span class="hs-identifier hs-var">encKS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160717"><span class="hs-identifier hs-var">decKS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; (KS, KS)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;aesKeySchedule: Invalid key size&quot;</span></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160720"><span class="annot"><span class="annottext">nk :: Int
</span><a href="#local-6989586621681160720"><span class="hs-identifier hs-var hs-var">nk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160721"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-315"></span><span>        </span><span id="local-6989586621681160715"><span class="annot"><span class="annottext">nr :: Int
</span><a href="#local-6989586621681160715"><span class="hs-identifier hs-var hs-var">nr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160720"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="hs-number">6</span></span><span>
</span><span id="line-316"></span><span>        </span><span id="local-6989586621681160718"><span class="annot"><span class="annottext">encKS :: KS
</span><a href="#local-6989586621681160718"><span class="hs-identifier hs-var">encKS</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681160714"><span class="annot"><span class="annottext">f :: State
</span><a href="#local-6989586621681160714"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160713"><span class="annot"><span class="annottext">m :: [State]
</span><a href="#local-6989586621681160713"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160712"><span class="annot"><span class="annottext">l :: State
</span><a href="#local-6989586621681160712"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[State] -&gt; State
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[State]
</span><a href="#local-6989586621681160710"><span class="hs-identifier hs-var">rKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [State] -&gt; [State]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160715"><span class="hs-identifier hs-var">nr</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[State] -&gt; [State]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[State]
</span><a href="#local-6989586621681160710"><span class="hs-identifier hs-var">rKeys</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[State]
</span><a href="#local-6989586621681160710"><span class="hs-identifier hs-var">rKeys</span></a></span><span> </span><span class="annot"><span class="annottext">[State] -&gt; Int -&gt; State
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160715"><span class="hs-identifier hs-var">nr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>        </span><span id="local-6989586621681160717"><span class="annot"><span class="annottext">decKS :: KS
</span><a href="#local-6989586621681160717"><span class="hs-identifier hs-var hs-var">decKS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160712"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(State -&gt; State) -&gt; [State] -&gt; [State]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#invMixColumns"><span class="hs-identifier hs-var">invMixColumns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[State] -&gt; [State]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[State]
</span><a href="#local-6989586621681160713"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160714"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>        </span><span id="local-6989586621681160710"><span class="annot"><span class="annottext">rKeys :: [State]
</span><a href="#local-6989586621681160710"><span class="hs-identifier hs-var hs-var">rKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; State -&gt; [State]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#keyExpansion"><span class="hs-identifier hs-var">keyExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160720"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160721"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">-- | Block encryption. The first argument is the plain-text, which must have</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- precisely 4 elements, for a total of 128-bits of input. The second</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- argument is the key-schedule to be used, obtained by a call to 'aesKeySchedule'.</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- The output will always have 4 32-bit words, which is the cipher-text.</span><span>
</span><span id="line-324"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#aesEncrypt"><span class="hs-identifier hs-type">aesEncrypt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#KS"><span class="hs-identifier hs-type">KS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span id="aesEncrypt"><span class="annot"><span class="annottext">aesEncrypt :: State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesEncrypt"><span class="hs-identifier hs-var hs-var">aesEncrypt</span></a></span></span><span> </span><span id="local-6989586621681160705"><span class="annot"><span class="annottext">pt :: State
</span><a href="#local-6989586621681160705"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621681160704"><span class="annot"><span class="annottext">encKS :: KS
</span><a href="#local-6989586621681160704"><span class="hs-identifier hs-var">encKS</span></a></span></span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">State -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160705"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; State -&gt; State -&gt; State) -&gt; KS -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#doRounds"><span class="hs-identifier hs-var">doRounds</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; State -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesRound"><span class="hs-identifier hs-var">aesRound</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160704"><span class="hs-identifier hs-var">encKS</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160705"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; State
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;aesEncrypt: Invalid plain-text size&quot;</span></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- | Block decryption. The arguments are the same as in 'aesEncrypt', except</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- the first argument is the cipher-text and the output is the corresponding</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- plain-text.</span><span>
</span><span id="line-334"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#aesDecrypt"><span class="hs-identifier hs-type">aesDecrypt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#KS"><span class="hs-identifier hs-type">KS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span id="aesDecrypt"><span class="annot"><span class="annottext">aesDecrypt :: State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesDecrypt"><span class="hs-identifier hs-var hs-var">aesDecrypt</span></a></span></span><span> </span><span id="local-6989586621681160702"><span class="annot"><span class="annottext">ct :: State
</span><a href="#local-6989586621681160702"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621681160701"><span class="annot"><span class="annottext">decKS :: KS
</span><a href="#local-6989586621681160701"><span class="hs-identifier hs-var">decKS</span></a></span></span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">State -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160702"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; State -&gt; State -&gt; State) -&gt; KS -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#doRounds"><span class="hs-identifier hs-var">doRounds</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; State -&gt; State -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesInvRound"><span class="hs-identifier hs-var">aesInvRound</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160701"><span class="hs-identifier hs-var">decKS</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160702"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; State
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;aesDecrypt: Invalid cipher-text size&quot;</span></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- * Test vectors</span><span>
</span><span id="line-343"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- ** 128-bit enc/dec test</span><span>
</span><span id="line-347"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="hs-comment">-- | 128-bit encryption test, from Appendix C.1 of the AES standard:</span><span>
</span><span id="line-350"></span><span class="hs-comment">--</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- &gt;&gt;&gt; map hex8 t128Enc</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- [&quot;69c4e0d8&quot;,&quot;6a7b0430&quot;,&quot;d8cdb780&quot;,&quot;70b4c55a&quot;]</span><span>
</span><span id="line-353"></span><span class="hs-comment">--</span><span>
</span><span id="line-354"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t128Enc"><span class="hs-identifier hs-type">t128Enc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-355"></span><span id="t128Enc"><span class="annot"><span class="annottext">t128Enc :: State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t128Enc"><span class="hs-identifier hs-var hs-var">t128Enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesEncrypt"><span class="hs-identifier hs-var">aesEncrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160699"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160698"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160699"><span class="annot"><span class="annottext">pt :: State
</span><a href="#local-6989586621681160699"><span class="hs-identifier hs-var hs-var">pt</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00112233</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x44556677</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x8899aabb</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0xccddeeff</span></span><span class="hs-special">]</span><span>
</span><span id="line-357"></span><span>        </span><span id="local-6989586621681160697"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160697"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00010203</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x04050607</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x08090a0b</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x0c0d0e0f</span></span><span class="hs-special">]</span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681160698"><span class="annot"><span class="annottext">ks :: KS
</span><a href="#local-6989586621681160698"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var">aesKeySchedule</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160697"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-comment">-- | 128-bit decryption test, from Appendix C.1 of the AES standard:</span><span>
</span><span id="line-361"></span><span class="hs-comment">--</span><span>
</span><span id="line-362"></span><span class="hs-comment">-- &gt;&gt;&gt; map hex8 t128Dec</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- [&quot;00112233&quot;,&quot;44556677&quot;,&quot;8899aabb&quot;,&quot;ccddeeff&quot;]</span><span>
</span><span id="line-364"></span><span class="hs-comment">--</span><span>
</span><span id="line-365"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t128Dec"><span class="hs-identifier hs-type">t128Dec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-366"></span><span id="t128Dec"><span class="annot"><span class="annottext">t128Dec :: State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t128Dec"><span class="hs-identifier hs-var hs-var">t128Dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesDecrypt"><span class="hs-identifier hs-var">aesDecrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160695"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160694"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160695"><span class="annot"><span class="annottext">ct :: State
</span><a href="#local-6989586621681160695"><span class="hs-identifier hs-var hs-var">ct</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x69c4e0d8</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x6a7b0430</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0xd8cdb780</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x70b4c55a</span></span><span class="hs-special">]</span><span>
</span><span id="line-368"></span><span>        </span><span id="local-6989586621681160693"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160693"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00010203</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x04050607</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x08090a0b</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x0c0d0e0f</span></span><span class="hs-special">]</span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160694"><span class="annot"><span class="annottext">ks :: KS
</span><a href="#local-6989586621681160694"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var">aesKeySchedule</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160693"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- ** 192-bit enc/dec test</span><span>
</span><span id="line-373"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-comment">-- | 192-bit encryption test, from Appendix C.2 of the AES standard:</span><span>
</span><span id="line-376"></span><span class="hs-comment">--</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- &gt;&gt;&gt; map hex8 t192Enc</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- [&quot;dda97ca4&quot;,&quot;864cdfe0&quot;,&quot;6eaf70a0&quot;,&quot;ec0d7191&quot;]</span><span>
</span><span id="line-379"></span><span class="hs-comment">--</span><span>
</span><span id="line-380"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t192Enc"><span class="hs-identifier hs-type">t192Enc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-381"></span><span id="t192Enc"><span class="annot"><span class="annottext">t192Enc :: State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t192Enc"><span class="hs-identifier hs-var hs-var">t192Enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesEncrypt"><span class="hs-identifier hs-var">aesEncrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160691"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160690"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160691"><span class="annot"><span class="annottext">pt :: State
</span><a href="#local-6989586621681160691"><span class="hs-identifier hs-var hs-var">pt</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00112233</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x44556677</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x8899aabb</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0xccddeeff</span></span><span class="hs-special">]</span><span>
</span><span id="line-383"></span><span>        </span><span id="local-6989586621681160689"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160689"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00010203</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x04050607</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x08090a0b</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x0c0d0e0f</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x10111213</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x14151617</span></span><span class="hs-special">]</span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681160690"><span class="annot"><span class="annottext">ks :: KS
</span><a href="#local-6989586621681160690"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var">aesKeySchedule</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160689"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">-- | 192-bit decryption test, from Appendix C.2 of the AES standard:</span><span>
</span><span id="line-387"></span><span class="hs-comment">--</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- &gt;&gt;&gt; map hex8 t192Dec</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- [&quot;00112233&quot;,&quot;44556677&quot;,&quot;8899aabb&quot;,&quot;ccddeeff&quot;]</span><span>
</span><span id="line-390"></span><span class="hs-comment">--</span><span>
</span><span id="line-391"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t192Dec"><span class="hs-identifier hs-type">t192Dec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-392"></span><span id="t192Dec"><span class="annot"><span class="annottext">t192Dec :: State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t192Dec"><span class="hs-identifier hs-var hs-var">t192Dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesDecrypt"><span class="hs-identifier hs-var">aesDecrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160687"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160686"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160687"><span class="annot"><span class="annottext">ct :: State
</span><a href="#local-6989586621681160687"><span class="hs-identifier hs-var hs-var">ct</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0xdda97ca4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x864cdfe0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x6eaf70a0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0xec0d7191</span></span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>        </span><span id="local-6989586621681160685"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160685"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00010203</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x04050607</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x08090a0b</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x0c0d0e0f</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x10111213</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x14151617</span></span><span class="hs-special">]</span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160686"><span class="annot"><span class="annottext">ks :: KS
</span><a href="#local-6989586621681160686"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var">aesKeySchedule</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160685"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- ** 256-bit enc/dec test</span><span>
</span><span id="line-399"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="hs-comment">-- | 256-bit encryption, from Appendix C.3 of the AES standard:</span><span>
</span><span id="line-402"></span><span class="hs-comment">--</span><span>
</span><span id="line-403"></span><span class="hs-comment">-- &gt;&gt;&gt; map hex8 t256Enc</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- [&quot;8ea2b7ca&quot;,&quot;516745bf&quot;,&quot;eafc4990&quot;,&quot;4b496089&quot;]</span><span>
</span><span id="line-405"></span><span class="hs-comment">--</span><span>
</span><span id="line-406"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t256Enc"><span class="hs-identifier hs-type">t256Enc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-407"></span><span id="t256Enc"><span class="annot"><span class="annottext">t256Enc :: State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t256Enc"><span class="hs-identifier hs-var hs-var">t256Enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesEncrypt"><span class="hs-identifier hs-var">aesEncrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160683"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160682"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160683"><span class="annot"><span class="annottext">pt :: State
</span><a href="#local-6989586621681160683"><span class="hs-identifier hs-var hs-var">pt</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00112233</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x44556677</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x8899aabb</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0xccddeeff</span></span><span class="hs-special">]</span><span>
</span><span id="line-409"></span><span>        </span><span id="local-6989586621681160681"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160681"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00010203</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x04050607</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x08090a0b</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x0c0d0e0f</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x10111213</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x14151617</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x18191a1b</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x1c1d1e1f</span></span><span class="hs-special">]</span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681160682"><span class="annot"><span class="annottext">ks :: KS
</span><a href="#local-6989586621681160682"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var">aesKeySchedule</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160681"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">-- | 256-bit decryption, from Appendix C.3 of the AES standard:</span><span>
</span><span id="line-413"></span><span class="hs-comment">--</span><span>
</span><span id="line-414"></span><span class="hs-comment">-- &gt;&gt;&gt; map hex8 t256Dec</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- [&quot;00112233&quot;,&quot;44556677&quot;,&quot;8899aabb&quot;,&quot;ccddeeff&quot;]</span><span>
</span><span id="line-416"></span><span class="hs-comment">--</span><span>
</span><span id="line-417"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#t256Dec"><span class="hs-identifier hs-type">t256Dec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-418"></span><span id="t256Dec"><span class="annot"><span class="annottext">t256Dec :: State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#t256Dec"><span class="hs-identifier hs-var hs-var">t256Dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesDecrypt"><span class="hs-identifier hs-var">aesDecrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160679"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160678"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160679"><span class="annot"><span class="annottext">ct :: State
</span><a href="#local-6989586621681160679"><span class="hs-identifier hs-var hs-var">ct</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x8ea2b7ca</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x516745bf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0xeafc4990</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x4b496089</span></span><span class="hs-special">]</span><span>
</span><span id="line-420"></span><span>        </span><span id="local-6989586621681160677"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160677"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00010203</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x04050607</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x08090a0b</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x0c0d0e0f</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x10111213</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x14151617</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x18191a1b</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x1c1d1e1f</span></span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160678"><span class="annot"><span class="annottext">ks :: KS
</span><a href="#local-6989586621681160678"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var">aesKeySchedule</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160677"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- * Verification</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- ${verifIntro}</span><span>
</span><span id="line-427"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-428"></span><span class="hs-comment">{- $verifIntro
  While SMT based technologies can prove correct many small properties fairly quickly, it would
  be naive for them to automatically verify that our AES implementation is correct. (By correct,
  we mean decryption follewed by encryption yielding the same result.) However, we can state
  this property precisely using SBV, and use quick-check to gain some confidence.
-}</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="hs-comment">-- | Correctness theorem for 128-bit AES. Ideally, we would run:</span><span>
</span><span id="line-436"></span><span class="hs-comment">--</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-438"></span><span class="hs-comment">--   prove aes128IsCorrect</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-440"></span><span class="hs-comment">--</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- to get a proof automatically. Unfortunately, while SBV will successfully generate the proof</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- obligation for this theorem and ship it to the SMT solver, it would be naive to expect the SMT-solver</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- to finish that proof in any reasonable time with the currently available SMT solving technologies.</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- Instead, we can issue:</span><span>
</span><span id="line-445"></span><span class="hs-comment">--</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-447"></span><span class="hs-comment">--   quickCheck aes128IsCorrect</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-449"></span><span class="hs-comment">-- </span><span>
</span><span id="line-450"></span><span class="hs-comment">-- and get some degree of confidence in our code. Similar predicates can be easily constructed for 192, and</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- 256 bit cases as well.</span><span>
</span><span id="line-452"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#aes128IsCorrect"><span class="hs-identifier hs-type">aes128IsCorrect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ plain-text words</span><span>
</span><span id="line-453"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ key-words</span><span>
</span><span id="line-454"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Data.html#SBool"><span class="hs-identifier hs-type">SBool</span></a></span><span>                                 </span><span class="hs-comment">-- ^ True if round-trip gives us plain-text back</span><span>
</span><span id="line-455"></span><span id="aes128IsCorrect"><span class="annot"><span class="annottext">aes128IsCorrect :: (SWord 32, SWord 32, SWord 32, SWord 32)
-&gt; (SWord 32, SWord 32, SWord 32, SWord 32) -&gt; SBool
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aes128IsCorrect"><span class="hs-identifier hs-var hs-var">aes128IsCorrect</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681160675"><span class="annot"><span class="annottext">i0 :: SWord 32
</span><a href="#local-6989586621681160675"><span class="hs-identifier hs-var">i0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160674"><span class="annot"><span class="annottext">i1 :: SWord 32
</span><a href="#local-6989586621681160674"><span class="hs-identifier hs-var">i1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160673"><span class="annot"><span class="annottext">i2 :: SWord 32
</span><a href="#local-6989586621681160673"><span class="hs-identifier hs-var">i2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160672"><span class="annot"><span class="annottext">i3 :: SWord 32
</span><a href="#local-6989586621681160672"><span class="hs-identifier hs-var">i3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681160671"><span class="annot"><span class="annottext">k0 :: SWord 32
</span><a href="#local-6989586621681160671"><span class="hs-identifier hs-var">k0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160670"><span class="annot"><span class="annottext">k1 :: SWord 32
</span><a href="#local-6989586621681160670"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160669"><span class="annot"><span class="annottext">k2 :: SWord 32
</span><a href="#local-6989586621681160669"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160668"><span class="annot"><span class="annottext">k3 :: SWord 32
</span><a href="#local-6989586621681160668"><span class="hs-identifier hs-var">k3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160667"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; SBool
forall a. EqSymbolic a =&gt; a -&gt; a -&gt; SBool
</span><a href="Data.SBV.Core.Model.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160666"><span class="hs-identifier hs-var">pt'</span></a></span><span>
</span><span id="line-456"></span><span>   </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160667"><span class="annot"><span class="annottext">pt :: State
</span><a href="#local-6989586621681160667"><span class="hs-identifier hs-var hs-var">pt</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160675"><span class="hs-identifier hs-var">i0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160674"><span class="hs-identifier hs-var">i1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160673"><span class="hs-identifier hs-var">i2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160672"><span class="hs-identifier hs-var">i3</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span>         </span><span id="local-6989586621681160665"><span class="annot"><span class="annottext">key :: State
</span><a href="#local-6989586621681160665"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160671"><span class="hs-identifier hs-var">k0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160670"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160669"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SWord 32
</span><a href="#local-6989586621681160668"><span class="hs-identifier hs-var">k3</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681160664"><span class="annot"><span class="annottext">encKS :: KS
</span><a href="#local-6989586621681160664"><span class="hs-identifier hs-var">encKS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160663"><span class="annot"><span class="annottext">decKS :: KS
</span><a href="#local-6989586621681160663"><span class="hs-identifier hs-var">decKS</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var">aesKeySchedule</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160665"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-459"></span><span>         </span><span id="local-6989586621681160662"><span class="annot"><span class="annottext">ct :: State
</span><a href="#local-6989586621681160662"><span class="hs-identifier hs-var hs-var">ct</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesEncrypt"><span class="hs-identifier hs-var">aesEncrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160667"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160664"><span class="hs-identifier hs-var">encKS</span></a></span><span>
</span><span id="line-460"></span><span>         </span><span id="local-6989586621681160666"><span class="annot"><span class="annottext">pt' :: State
</span><a href="#local-6989586621681160666"><span class="hs-identifier hs-var hs-var">pt'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesDecrypt"><span class="hs-identifier hs-var">aesDecrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160662"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160663"><span class="hs-identifier hs-var">decKS</span></a></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- * Code generation</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- ${codeGenIntro}</span><span>
</span><span id="line-465"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-466"></span><span class="hs-comment">{- $codeGenIntro
   We have emphasized that our T-Box implementation in Haskell was guided by clarity and correctness, not
   performance. Indeed, our implementation is hardly the fastest AES implementation in Haskell. However,
   we can use it to automatically generate straight-line C-code that can run fairly fast.

   For the purposes of illustration, we only show here how to generate code for a 128-bit AES block-encrypt
   function, that takes 8 32-bit words as an argument. The first 4 are the 128-bit input, and the final
   four are the 128-bit key. The impact of this is that the generated function would expand the key for
   each block of encryption, a needless task unless we change the key in every block. In a more serios application,
   we would instead generate code for both the 'aesKeySchedule' and the 'aesEncrypt' functions, thus reusing the
   key-schedule over many applications of the encryption call. (Unfortunately doing this is rather cumbersome right
   now, since Haskell does not support fixed-size lists.)
-}</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="hs-comment">-- | Code generation for 128-bit AES encryption.</span><span>
</span><span id="line-481"></span><span class="hs-comment">--</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- The following sample from the generated code-lines show how T-Boxes are rendered as C arrays:</span><span>
</span><span id="line-483"></span><span class="hs-comment">--</span><span>
</span><span id="line-484"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-485"></span><span class="hs-comment">--   static const SWord32 table1[] = {</span><span>
</span><span id="line-486"></span><span class="hs-comment">--       0xc66363a5UL, 0xf87c7c84UL, 0xee777799UL, 0xf67b7b8dUL,</span><span>
</span><span id="line-487"></span><span class="hs-comment">--       0xfff2f20dUL, 0xd66b6bbdUL, 0xde6f6fb1UL, 0x91c5c554UL,</span><span>
</span><span id="line-488"></span><span class="hs-comment">--       0x60303050UL, 0x02010103UL, 0xce6767a9UL, 0x562b2b7dUL,</span><span>
</span><span id="line-489"></span><span class="hs-comment">--       0xe7fefe19UL, 0xb5d7d762UL, 0x4dababe6UL, 0xec76769aUL,</span><span>
</span><span id="line-490"></span><span class="hs-comment">--       ...</span><span>
</span><span id="line-491"></span><span class="hs-comment">--       }</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-493"></span><span class="hs-comment">--</span><span>
</span><span id="line-494"></span><span class="hs-comment">-- The generated program has 5 tables (one sbox table, and 4-Tboxes), all converted to fast C arrays. Here</span><span>
</span><span id="line-495"></span><span class="hs-comment">-- is a sample of the generated straightline C-code:</span><span>
</span><span id="line-496"></span><span class="hs-comment">--</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-498"></span><span class="hs-comment">--   const SWord8  s1915 = (SWord8) s1912;</span><span>
</span><span id="line-499"></span><span class="hs-comment">--   const SWord8  s1916 = table0[s1915];</span><span>
</span><span id="line-500"></span><span class="hs-comment">--   const SWord16 s1917 = (((SWord16) s1914) &lt;&lt; 8) | ((SWord16) s1916);</span><span>
</span><span id="line-501"></span><span class="hs-comment">--   const SWord32 s1918 = (((SWord32) s1911) &lt;&lt; 16) | ((SWord32) s1917);</span><span>
</span><span id="line-502"></span><span class="hs-comment">--   const SWord32 s1919 = s1844 ^ s1918;</span><span>
</span><span id="line-503"></span><span class="hs-comment">--   const SWord32 s1920 = s1903 ^ s1919;</span><span>
</span><span id="line-504"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-505"></span><span class="hs-comment">--</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- The GNU C-compiler does a fine job of optimizing this straightline code to generate a fairly efficient C implementation.</span><span>
</span><span id="line-507"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#cgAES128BlockEncrypt"><span class="hs-identifier hs-type">cgAES128BlockEncrypt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span id="cgAES128BlockEncrypt"><span class="annot"><span class="annottext">cgAES128BlockEncrypt :: IO ()
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#cgAES128BlockEncrypt"><span class="hs-identifier hs-var hs-var">cgAES128BlockEncrypt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; SBVCodeGen () -&gt; IO ()
forall a. Maybe [Char] -&gt; [Char] -&gt; SBVCodeGen a -&gt; IO a
</span><a href="Data.SBV.Compilers.C.html#compileToC"><span class="hs-identifier hs-var">compileToC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="hs-string">&quot;aes128BlockEncrypt&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SBVCodeGen () -&gt; IO ()) -&gt; SBVCodeGen () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-509"></span><span>        </span><span id="local-6989586621681160659"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160659"><span class="hs-identifier hs-var">pt</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; SBVCodeGen State
forall a. SymVal a =&gt; Int -&gt; [Char] -&gt; SBVCodeGen [SBV a]
</span><a href="Data.SBV.Compilers.CodeGen.html#cgInputArr"><span class="hs-identifier hs-var">cgInputArr</span></a></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="hs-string">&quot;pt&quot;</span></span><span>        </span><span class="hs-comment">-- plain-text as an array of 4 Word32's</span><span>
</span><span id="line-510"></span><span>        </span><span id="local-6989586621681160657"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160657"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; SBVCodeGen State
forall a. SymVal a =&gt; Int -&gt; [Char] -&gt; SBVCodeGen [SBV a]
</span><a href="Data.SBV.Compilers.CodeGen.html#cgInputArr"><span class="hs-identifier hs-var">cgInputArr</span></a></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span>       </span><span class="hs-comment">-- key as an array of 4 Word32s</span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-comment">-- Use the test values from Appendix C.1 of the AES standard as the driver values</span><span>
</span><span id="line-512"></span><span>        </span><span class="annot"><span class="annottext">[Integer] -&gt; SBVCodeGen ()
</span><a href="Data.SBV.Compilers.CodeGen.html#cgSetDriverValues"><span class="hs-identifier hs-var">cgSetDriverValues</span></a></span><span> </span><span class="annot"><span class="annottext">([Integer] -&gt; SBVCodeGen ()) -&gt; [Integer] -&gt; SBVCodeGen ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00112233</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x44556677</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x8899aabb</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0xccddeeff</span></span><span class="hs-special">]</span><span>
</span><span id="line-513"></span><span>                            </span><span class="annot"><span class="annottext">[Integer] -&gt; [Integer] -&gt; [Integer]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0x00010203</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x04050607</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x08090a0b</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0x0c0d0e0f</span></span><span class="hs-special">]</span><span>
</span><span id="line-514"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681160655"><span class="annot"><span class="annottext">encKs :: KS
</span><a href="#local-6989586621681160655"><span class="hs-identifier hs-var">encKs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var">aesKeySchedule</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160657"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-515"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; State -&gt; SBVCodeGen ()
forall a. SymVal a =&gt; [Char] -&gt; [SBV a] -&gt; SBVCodeGen ()
</span><a href="Data.SBV.Compilers.CodeGen.html#cgOutputArr"><span class="hs-identifier hs-var">cgOutputArr</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ct&quot;</span></span><span> </span><span class="annot"><span class="annottext">(State -&gt; SBVCodeGen ()) -&gt; State -&gt; SBVCodeGen ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesEncrypt"><span class="hs-identifier hs-var">aesEncrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160659"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160655"><span class="hs-identifier hs-var">encKs</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-518"></span><span class="hs-comment">-- * C-library generation</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- ${libraryIntro}</span><span>
</span><span id="line-520"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-521"></span><span class="hs-comment">{- $libraryIntro
   The 'cgAES128BlockEncrypt' example shows how to generate code for 128-bit AES encryption. As the generated
   function performs encryption on a given block, it performs key expansion as necessary. However, this is
   not quite practical: We would like to expand the key only once, and encrypt the stream of plain-text blocks using
   the same expanded key (potentially using some crypto-mode), until we decide to change the key. In this
   section, we show how to use SBV to instead generate a library of functions that can be used in such a scenario.
   The generated library is a typical @.a@ archive, that can be linked using the C-compiler as usual.
-}</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="hs-comment">-- | Components of the AES implementation that the library is generated from</span><span>
</span><span id="line-531"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#aesLibComponents"><span class="hs-identifier hs-type">aesLibComponents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.SBV.Compilers.CodeGen.html#SBVCodeGen"><span class="hs-identifier hs-type">SBVCodeGen</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-532"></span><span id="aesLibComponents"><span class="annot"><span class="annottext">aesLibComponents :: Int -&gt; [([Char], SBVCodeGen ())]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesLibComponents"><span class="hs-identifier hs-var hs-var">aesLibComponents</span></a></span></span><span> </span><span id="local-6989586621681160651"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621681160651"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;aes&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160651"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;KeySchedule&quot;</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">SBVCodeGen ()
</span><a href="#local-6989586621681160650"><span class="hs-identifier hs-var">keySchedule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;aes&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160651"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;BlockEncrypt&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SBVCodeGen ()
</span><a href="#local-6989586621681160649"><span class="hs-identifier hs-var">enc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;aes&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160651"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;BlockDecrypt&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SBVCodeGen ()
</span><a href="#local-6989586621681160648"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-536"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- key-schedule</span><span>
</span><span id="line-537"></span><span>        </span><span id="local-6989586621681160647"><span class="annot"><span class="annottext">nk :: Int
</span><a href="#local-6989586621681160647"><span class="hs-identifier hs-var hs-var">nk</span></a></span></span><span>
</span><span id="line-538"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160651"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">128</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>
</span><span id="line-539"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160651"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">192</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">6</span></span><span>
</span><span id="line-540"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160651"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-number">256</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-541"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Int) -&gt; [Char] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;aesLibComponents: Size must be one of 128, 192, or 256; received: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160651"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-542"></span><span>        </span><span class="hs-comment">-- We get 4*(nr+1) keys, where nr = nk + 6</span><span>
</span><span id="line-543"></span><span>        </span><span id="local-6989586621681160646"><span class="annot"><span class="annottext">nr :: Int
</span><a href="#local-6989586621681160646"><span class="hs-identifier hs-var hs-var">nr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160647"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="hs-number">6</span></span><span>
</span><span id="line-544"></span><span>        </span><span id="local-6989586621681160645"><span class="annot"><span class="annottext">xk :: Int
</span><a href="#local-6989586621681160645"><span class="hs-identifier hs-var hs-var">xk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160646"><span class="hs-identifier hs-var">nr</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>        </span><span id="local-6989586621681160650"><span class="annot"><span class="annottext">keySchedule :: SBVCodeGen ()
</span><a href="#local-6989586621681160650"><span class="hs-identifier hs-var hs-var">keySchedule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681160643"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160643"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; SBVCodeGen State
forall a. SymVal a =&gt; Int -&gt; [Char] -&gt; SBVCodeGen [SBV a]
</span><a href="Data.SBV.Compilers.CodeGen.html#cgInputArr"><span class="hs-identifier hs-var">cgInputArr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160647"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span>     </span><span class="hs-comment">-- key</span><span>
</span><span id="line-546"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681160642"><span class="annot"><span class="annottext">encKS :: KS
</span><a href="#local-6989586621681160642"><span class="hs-identifier hs-var">encKS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160641"><span class="annot"><span class="annottext">decKS :: KS
</span><a href="#local-6989586621681160641"><span class="hs-identifier hs-var">decKS</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; (KS, KS)
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesKeySchedule"><span class="hs-identifier hs-var">aesKeySchedule</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160643"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-547"></span><span>                         </span><span class="annot"><span class="annottext">[Char] -&gt; State -&gt; SBVCodeGen ()
forall a. SymVal a =&gt; [Char] -&gt; [SBV a] -&gt; SBVCodeGen ()
</span><a href="Data.SBV.Compilers.CodeGen.html#cgOutputArr"><span class="hs-identifier hs-var">cgOutputArr</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encKS&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KS -&gt; State
</span><a href="#local-6989586621681160640"><span class="hs-identifier hs-var">ksToXKey</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160642"><span class="hs-identifier hs-var">encKS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>                         </span><span class="annot"><span class="annottext">[Char] -&gt; State -&gt; SBVCodeGen ()
forall a. SymVal a =&gt; [Char] -&gt; [SBV a] -&gt; SBVCodeGen ()
</span><a href="Data.SBV.Compilers.CodeGen.html#cgOutputArr"><span class="hs-identifier hs-var">cgOutputArr</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;decKS&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KS -&gt; State
</span><a href="#local-6989586621681160640"><span class="hs-identifier hs-var">ksToXKey</span></a></span><span> </span><span class="annot"><span class="annottext">KS
</span><a href="#local-6989586621681160641"><span class="hs-identifier hs-var">decKS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>        </span><span class="hs-comment">-- encryption</span><span>
</span><span id="line-550"></span><span>        </span><span id="local-6989586621681160649"><span class="annot"><span class="annottext">enc :: SBVCodeGen ()
</span><a href="#local-6989586621681160649"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681160639"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160639"><span class="hs-identifier hs-var">pt</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; SBVCodeGen State
forall a. SymVal a =&gt; Int -&gt; [Char] -&gt; SBVCodeGen [SBV a]
</span><a href="Data.SBV.Compilers.CodeGen.html#cgInputArr"><span class="hs-identifier hs-var">cgInputArr</span></a></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>  </span><span class="annot"><span class="hs-string">&quot;pt&quot;</span></span><span>    </span><span class="hs-comment">-- plain-text</span><span>
</span><span id="line-551"></span><span>                 </span><span id="local-6989586621681160638"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160638"><span class="hs-identifier hs-var">xkey</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; SBVCodeGen State
forall a. SymVal a =&gt; Int -&gt; [Char] -&gt; SBVCodeGen [SBV a]
</span><a href="Data.SBV.Compilers.CodeGen.html#cgInputArr"><span class="hs-identifier hs-var">cgInputArr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160645"><span class="hs-identifier hs-var">xk</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;xkey&quot;</span></span><span>  </span><span class="hs-comment">-- expanded key</span><span>
</span><span id="line-552"></span><span>                 </span><span class="annot"><span class="annottext">[Char] -&gt; State -&gt; SBVCodeGen ()
forall a. SymVal a =&gt; [Char] -&gt; [SBV a] -&gt; SBVCodeGen ()
</span><a href="Data.SBV.Compilers.CodeGen.html#cgOutputArr"><span class="hs-identifier hs-var">cgOutputArr</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ct&quot;</span></span><span> </span><span class="annot"><span class="annottext">(State -&gt; SBVCodeGen ()) -&gt; State -&gt; SBVCodeGen ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesEncrypt"><span class="hs-identifier hs-var">aesEncrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160639"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State -&gt; KS
</span><a href="#local-6989586621681160637"><span class="hs-identifier hs-var">xkeyToKS</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160638"><span class="hs-identifier hs-var">xkey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>        </span><span class="hs-comment">-- decryption</span><span>
</span><span id="line-554"></span><span>        </span><span id="local-6989586621681160648"><span class="annot"><span class="annottext">dec :: SBVCodeGen ()
</span><a href="#local-6989586621681160648"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681160636"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160636"><span class="hs-identifier hs-var">pt</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; SBVCodeGen State
forall a. SymVal a =&gt; Int -&gt; [Char] -&gt; SBVCodeGen [SBV a]
</span><a href="Data.SBV.Compilers.CodeGen.html#cgInputArr"><span class="hs-identifier hs-var">cgInputArr</span></a></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>  </span><span class="annot"><span class="hs-string">&quot;ct&quot;</span></span><span>    </span><span class="hs-comment">-- cipher-text</span><span>
</span><span id="line-555"></span><span>                 </span><span id="local-6989586621681160635"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160635"><span class="hs-identifier hs-var">xkey</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; SBVCodeGen State
forall a. SymVal a =&gt; Int -&gt; [Char] -&gt; SBVCodeGen [SBV a]
</span><a href="Data.SBV.Compilers.CodeGen.html#cgInputArr"><span class="hs-identifier hs-var">cgInputArr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160645"><span class="hs-identifier hs-var">xk</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;xkey&quot;</span></span><span>  </span><span class="hs-comment">-- expanded key</span><span>
</span><span id="line-556"></span><span>                 </span><span class="annot"><span class="annottext">[Char] -&gt; State -&gt; SBVCodeGen ()
forall a. SymVal a =&gt; [Char] -&gt; [SBV a] -&gt; SBVCodeGen ()
</span><a href="Data.SBV.Compilers.CodeGen.html#cgOutputArr"><span class="hs-identifier hs-var">cgOutputArr</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;pt&quot;</span></span><span> </span><span class="annot"><span class="annottext">(State -&gt; SBVCodeGen ()) -&gt; State -&gt; SBVCodeGen ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; KS -&gt; State
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesDecrypt"><span class="hs-identifier hs-var">aesDecrypt</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160636"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State -&gt; KS
</span><a href="#local-6989586621681160637"><span class="hs-identifier hs-var">xkeyToKS</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160635"><span class="hs-identifier hs-var">xkey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>        </span><span class="hs-comment">-- Transforming back and forth from our KS type to a flat array used by the generated C code</span><span>
</span><span id="line-558"></span><span>        </span><span class="hs-comment">-- Turn a series of expanded keys to our internal KS type</span><span>
</span><span id="line-559"></span><span>        </span><span class="annot"><a href="#local-6989586621681160637"><span class="hs-identifier hs-type">xkeyToKS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#KS"><span class="hs-identifier hs-type">KS</span></a></span><span>
</span><span id="line-560"></span><span>        </span><span id="local-6989586621681160637"><span class="annot"><span class="annottext">xkeyToKS :: State -&gt; KS
</span><a href="#local-6989586621681160637"><span class="hs-identifier hs-var hs-var">xkeyToKS</span></a></span></span><span> </span><span id="local-6989586621681160634"><span class="annot"><span class="annottext">xs :: State
</span><a href="#local-6989586621681160634"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160633"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[State]
</span><a href="#local-6989586621681160632"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160631"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>           </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160633"><span class="annot"><span class="annottext">f :: State
</span><a href="#local-6989586621681160633"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; State -&gt; State
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160634"><span class="hs-identifier hs-var">xs</span></a></span><span>                             </span><span class="hs-comment">-- first round key</span><span>
</span><span id="line-562"></span><span>                 </span><span id="local-6989586621681160632"><span class="annot"><span class="annottext">m :: [State]
</span><a href="#local-6989586621681160632"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; [State]
forall a. [a] -&gt; [[a]]
</span><a href="#local-6989586621681160630"><span class="hs-identifier hs-var">chop4</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; State -&gt; State
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160645"><span class="hs-identifier hs-var">xk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; State -&gt; State
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160634"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- middle rounds</span><span>
</span><span id="line-563"></span><span>                 </span><span id="local-6989586621681160631"><span class="annot"><span class="annottext">l :: State
</span><a href="#local-6989586621681160631"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; State -&gt; State
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160645"><span class="hs-identifier hs-var">xk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160634"><span class="hs-identifier hs-var">xs</span></a></span><span>                      </span><span class="hs-comment">-- last round key</span><span>
</span><span id="line-564"></span><span>        </span><span class="hs-comment">-- Turn a KS to a series of expanded key words</span><span>
</span><span id="line-565"></span><span>        </span><span class="annot"><a href="#local-6989586621681160640"><span class="hs-identifier hs-type">ksToXKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#KS"><span class="hs-identifier hs-type">KS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.SBV.Core.Sized.html#SWord"><span class="hs-identifier hs-type">SWord</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-566"></span><span>        </span><span id="local-6989586621681160640"><span class="annot"><span class="annottext">ksToXKey :: KS -&gt; State
</span><a href="#local-6989586621681160640"><span class="hs-identifier hs-var hs-var">ksToXKey</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681160629"><span class="annot"><span class="annottext">f :: State
</span><a href="#local-6989586621681160629"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160628"><span class="annot"><span class="annottext">m :: [State]
</span><a href="#local-6989586621681160628"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160627"><span class="annot"><span class="annottext">l :: State
</span><a href="#local-6989586621681160627"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160629"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; State
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[State] -&gt; State
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[State]
</span><a href="#local-6989586621681160628"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; State
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621681160627"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-comment">-- chunk in fours. (This function must be in some standard library, where?)</span><span>
</span><span id="line-568"></span><span>        </span><span id="local-6989586621681160625"><span class="annot"><a href="#local-6989586621681160630"><span class="hs-identifier hs-type">chop4</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681160625"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681160625"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span></span><span>
</span><span id="line-569"></span><span>        </span><span id="local-6989586621681160630"><span class="annot"><span class="annottext">chop4 :: [a] -&gt; [[a]]
</span><a href="#local-6989586621681160630"><span class="hs-identifier hs-var hs-var">chop4</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-570"></span><span>        </span><span class="annot"><a href="#local-6989586621681160630"><span class="hs-identifier hs-var">chop4</span></a></span><span> </span><span id="local-6989586621681160624"><span class="annot"><span class="annottext">xs :: [a]
</span><a href="#local-6989586621681160624"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681160623"><span class="annot"><span class="annottext">f :: [a]
</span><a href="#local-6989586621681160623"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681160622"><span class="annot"><span class="annottext">r :: [a]
</span><a href="#local-6989586621681160622"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [a] -&gt; ([a], [a])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681160624"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681160623"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [[a]] -&gt; [[a]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [[a]]
forall a. [a] -&gt; [[a]]
</span><a href="#local-6989586621681160630"><span class="hs-identifier hs-var">chop4</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681160622"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="hs-comment">-- | Generate code for AES functionality; given the key size.</span><span>
</span><span id="line-573"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#cgAESLibrary"><span class="hs-identifier hs-type">cgAESLibrary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span id="cgAESLibrary"><span class="annot"><span class="annottext">cgAESLibrary :: Int -&gt; Maybe [Char] -&gt; IO ()
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#cgAESLibrary"><span class="hs-identifier hs-var hs-var">cgAESLibrary</span></a></span></span><span> </span><span id="local-6989586621681160619"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621681160619"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621681160618"><span class="annot"><span class="annottext">mbd :: Maybe [Char]
</span><a href="#local-6989586621681160618"><span class="hs-identifier hs-var">mbd</span></a></span></span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160619"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">128</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">192</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">256</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO [()] -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO [()] -&gt; IO ()) -&gt; IO [()] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; [([Char], SBVCodeGen ())] -&gt; IO [()]
forall a.
Maybe [Char] -&gt; [Char] -&gt; [([Char], SBVCodeGen a)] -&gt; IO [a]
</span><a href="Data.SBV.Compilers.C.html#compileToCLib"><span class="hs-identifier hs-var">compileToCLib</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621681160618"><span class="hs-identifier hs-var">mbd</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681160616"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [([Char], SBVCodeGen ())]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#aesLibComponents"><span class="hs-identifier hs-var">aesLibComponents</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160619"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;cgAESLibrary: Size must be one of 128, 192, or 256, received: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160619"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160616"><span class="annot"><span class="annottext">nm :: [Char]
</span><a href="#local-6989586621681160616"><span class="hs-identifier hs-var hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;aes&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681160619"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Lib&quot;</span></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="hs-comment">-- | Generate a C library, containing functions for performing 128-bit enc/dec/key-expansion.</span><span>
</span><span id="line-580"></span><span class="hs-comment">-- A note on performance: In a very rough speed test, the generated code was able to do</span><span>
</span><span id="line-581"></span><span class="hs-comment">-- 6.3 million block encryptions per second on a decent MacBook Pro. On the same machine, OpenSSL</span><span>
</span><span id="line-582"></span><span class="hs-comment">-- reports 8.2 million block encryptions per second. So, the generated code is about 25% slower</span><span>
</span><span id="line-583"></span><span class="hs-comment">-- as compared to the highly optimized OpenSSL implementation. (Note that the speed test was done</span><span>
</span><span id="line-584"></span><span class="hs-comment">-- somewhat simplistically, so these numbers should be considered very rough estimates.)</span><span>
</span><span id="line-585"></span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#cgAES128Library"><span class="hs-identifier hs-type">cgAES128Library</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span id="cgAES128Library"><span class="annot"><span class="annottext">cgAES128Library :: IO ()
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#cgAES128Library"><span class="hs-identifier hs-var hs-var">cgAES128Library</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe [Char] -&gt; IO ()
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#cgAESLibrary"><span class="hs-identifier hs-var">cgAESLibrary</span></a></span><span> </span><span class="annot"><span class="hs-number">128</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="hs-comment">--------------------------------------------------------------------------------------------</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- | For doctest purposes only</span><span>
</span><span id="line-590"></span><span id="local-6989586621681160614"><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#hex8"><span class="hs-identifier hs-type">hex8</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.SBV.Core.Data.html#SymVal"><span class="hs-identifier hs-type">SymVal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681160614"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621681160614"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integral</span></span><span> </span><span class="annot"><a href="#local-6989586621681160614"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.SBV.Core.Data.html#SBV"><span class="hs-identifier hs-type">SBV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681160614"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-591"></span><span id="hex8"><span class="annot"><span class="annottext">hex8 :: SBV a -&gt; [Char]
</span><a href="Documentation.SBV.Examples.Crypto.AES.html#hex8"><span class="hs-identifier hs-var hs-var">hex8</span></a></span></span><span> </span><span id="local-6989586621681160612"><span class="annot"><span class="annottext">v :: SBV a
</span><a href="#local-6989586621681160612"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char -&gt; [Char]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681160610"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-char">'0'</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621681160610"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681160610"><span class="annot"><span class="annottext">s :: [Char]
</span><a href="#local-6989586621681160610"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; [Char] -&gt; [Char]) -&gt; [Char] -&gt; a -&gt; [Char]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [Char] -&gt; [Char]
forall a. (Integral a, Show a) =&gt; a -&gt; [Char] -&gt; [Char]
</span><span class="hs-identifier hs-var">showHex</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; [Char]) -&gt; (SBV a -&gt; a) -&gt; SBV a -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; a
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; a) -&gt; (SBV a -&gt; Maybe a) -&gt; SBV a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SBV a -&gt; Maybe a
forall a. SymVal a =&gt; SBV a -&gt; Maybe a
</span><a href="Data.SBV.Core.Data.html#unliteral"><span class="hs-identifier hs-var">unliteral</span></a></span><span> </span><span class="annot"><span class="annottext">(SBV a -&gt; [Char]) -&gt; SBV a -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SBV a
</span><a href="#local-6989586621681160612"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#aesRound"><span class="hs-pragma hs-type">aesRound</span></a></span><span>    </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Use head&quot;</span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-595"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="annot"><a href="Documentation.SBV.Examples.Crypto.AES.html#aesInvRound"><span class="hs-pragma hs-type">aesInvRound</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Use head&quot;</span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-596"></span></pre></body></html>